<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SPX102 Coach Ross</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <!-- Tailwind CSS for modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      font-family: 'Open Sans', sans-serif;
      --color-primary: #0052C4;
      --color-secondary: #fce726;
      --color-surface: #ffffff;
      --color-muted: #f8fafc;
      --color-border: #e2e8f0;
      --color-text: #0f172a;
      --color-subtle: #475569;
    }
    
    /* Custom Scrollbar */
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    
    .custom-scroll::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scroll::-webkit-scrollbar-track {
      background: rgba(226, 232, 240, 0.8);
    }
    .custom-scroll::-webkit-scrollbar-thumb {
      background-color: #94a3b8;
      border-radius: 20px;
    }

    /* Message Bubbles */
    .msg-user {
      border-radius: 18px 18px 4px 18px;
    }
    .msg-bot {
      border-radius: 18px 18px 18px 4px;
    }

    .msg-user,
    .msg-bot,
    .rich-text {
      word-break: break-word;
      overflow-wrap: anywhere;
      hyphens: auto;
      max-width: 100%;
    }

    /* Bounce animation for dots */
    .typing-dot {
      animation: bounce 1.4s infinite ease-in-out both;
      background-color: #94a3b8; 
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin: 0 2px;
    }
    
    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    /* Gradient Text */
    .text-gradient {
      background: linear-gradient(to right, #0052C4, #1a73e8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Rich text styling for bot replies */
    .rich-text {
      color: var(--color-text);
    }
    .rich-text h2,
    .rich-text h3,
    .rich-text h4 {
      font-weight: 700;
      letter-spacing: -0.01em;
      color: var(--color-primary);
      margin-bottom: 0.35rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }
    .rich-text h2::before,
    .rich-text h3::before,
    .rich-text h4::before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 9999px;
      background: linear-gradient(135deg, #0052C4, #1a73e8);
      box-shadow: 0 0 0 6px rgba(0, 82, 196, 0.08);
    }
    .rich-text p {
      margin-bottom: 0.75rem;
      line-height: 1.7;
    }
    .rich-text ul {
      list-style: none;
      padding-left: 0;
      margin: 0.5rem 0 1rem;
      display: grid;
      gap: 0.35rem;
    }
    .rich-text ul li {
      position: relative;
      padding-left: 1.2rem;
    }
    .rich-text ul li::before {
      content: "•";
      position: absolute;
      left: 0;
      top: 0;
      color: var(--color-primary);
      font-weight: 700;
    }
    .rich-text ol {
      counter-reset: item;
      padding-left: 0;
      margin: 0.5rem 0 1rem;
      display: grid;
      gap: 0.35rem;
    }
    .rich-text ol li {
      counter-increment: item;
      padding-left: 1.6rem;
      position: relative;
    }
    .rich-text ol li::before {
      content: counter(item) ".";
      position: absolute;
      left: 0;
      top: 0;
      color: var(--color-primary);
      font-weight: 700;
    }
    .rich-text hr {
      border: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(148, 163, 184, 0.4), transparent);
      margin: 1.5rem 0;
    }
    .rich-text table {
      width: 100%;
      max-width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 12px;
      overflow: hidden;
      background: #f8fafc;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .rich-text th,
    .rich-text td {
      padding: 0.65rem 0.9rem;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    }
    .rich-text th {
      background: linear-gradient(90deg, rgba(0, 82, 196, 0.12), rgba(26, 115, 232, 0.08));
      color: #0f172a;
      font-weight: 700;
      letter-spacing: 0.01em;
      text-transform: uppercase;
      font-size: 0.75rem;
    }
    .rich-text tr:last-child td {
      border-bottom: none;
    }
    .rich-text strong {
      color: #0f172a;
      font-weight: 700;
    }
    .rich-text .card-block {
      background: linear-gradient(145deg, rgba(0, 82, 196, 0.06), rgba(240, 247, 255, 0.9));
      border: 1px solid rgba(0, 82, 196, 0.25);
      padding: 1rem;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 82, 196, 0.08);
      backdrop-filter: blur(6px);
      margin-bottom: 0.9rem;
    }

    .tts-button {
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #475569;
      background: #f8fafc;
      transition: all 0.2s ease;
    }
    .tts-button:hover {
      color: #0052C4;
      border-color: rgba(0, 82, 196, 0.6);
      background: #eff6ff;
    }
    .tts-button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }
    .tts-button[data-state="loading"] {
      color: #0052C4;
      border-color: rgba(0, 82, 196, 0.4);
      background: rgba(219, 234, 254, 0.6);
      animation: ttsPulse 1.1s ease-in-out infinite;
    }
    .tts-button[data-state="loading"] svg {
      animation: ttsSpin 1s linear infinite;
    }
    .tts-highlight {
      background-color: var(--color-secondary);
      border-radius: 6px;
      box-decoration-break: clone;
      -webkit-box-decoration-break: clone;
    }
    .copy-button {
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #475569;
      background: #f8fafc;
      transition: all 0.2s ease;
    }
    .copy-button:hover {
      color: #0052C4;
      border-color: rgba(0, 82, 196, 0.6);
      background: #eff6ff;
    }
    .copy-button[data-state="copied"] {
      color: #0f172a;
      border-color: rgba(14, 116, 144, 0.55);
      background: rgba(224, 242, 254, 0.9);
    }
    @keyframes ttsPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }
    @keyframes ttsSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .bottom-safety-pad {
      height: 5vh;
      min-height: 32px;
      background: var(--color-primary);
    }

    @media print {
      header,
      footer,
      #clinical-toggle,
      #sports-toggle,
      .tts-button,
      .copy-button,
      #download-chat,
      #speech-options-toggle {
        display: none !important;
      }

      body,
      #chat-log {
        overflow: visible !important;
        height: auto !important;
        background: white !important;
      }

      .msg-bot,
      .msg-user {
        border: 1px solid #e2e8f0 !important;
        box-shadow: none !important;
        break-inside: avoid;
      }
    }
  </style>
</head>
<body class="bg-white text-slate-900 h-screen flex flex-col overflow-hidden selection:bg-[#0052C4] selection:text-white">

  <!-- Header -->
  <header class="flex-none bg-white backdrop-blur-md border-b border-slate-200 p-4 flex items-center gap-4 z-20 shadow-sm">
    <div class="relative group cursor-pointer">
      <div class="absolute -inset-0.5 bg-gradient-to-r from-[#0052C4] to-[#1a73e8] rounded-full blur opacity-40 group-hover:opacity-80 transition duration-500"></div>
      <img
        src="./ross pic.png"
        alt="Ross Clark"
        class="relative w-12 h-12 rounded-full object-cover border-2 border-white"
        onerror="this.src='https://ui-avatars.com/api/?name=Ross+Clark&background=6366f1&color=fff'"
      />
      <div class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full animate-pulse"></div>
    </div>
    
    <div class="flex-1 min-w-0">
      <h1 class="text-lg font-semibold text-slate-900 truncate flex items-center gap-2">
        Dr. Ross Clark
        <span class="px-2 py-0.5 rounded-full bg-[#0052C4]/10 text-[#0052C4] text-xs font-medium border border-[#0052C4]/20">AI Coach</span>
      </h1>
      <p class="text-xs text-slate-500 truncate">SPX102 Introduction to Coaching • Always Here for You!</p>
    </div>
    
    <div class="flex items-center gap-2 ml-auto">
      <button id="download-chat" class="inline-flex items-center gap-2 px-3 py-2 text-sm font-semibold text-white bg-[#0052C4] hover:bg-[#1a73e8] rounded-full shadow-sm transition-colors" type="button">
        <i data-lucide="download" class="w-4 h-4"></i>
        <span>Download Chat</span>
      </button>
      <div class="relative">
        <button id="speech-options-toggle" class="inline-flex items-center gap-2 px-3 py-2 text-sm font-semibold text-[#0052C4] border border-[#0052C4]/40 hover:border-[#0052C4] bg-white rounded-full shadow-sm transition-colors" type="button" aria-label="Speech options">
          <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
          <span>Speech options</span>
        </button>
        <div id="speech-options-panel" class="hidden absolute right-0 mt-3 w-64 rounded-2xl border border-slate-200 bg-white shadow-lg p-4 space-y-4 z-30">
          <div class="space-y-2">
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Speech engine</p>
            <select id="speech-engine" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-[#0052C4]/40">
              <option value="huggingface">Hugging Face (English voices)</option>
              <option value="browser">Browser default (all languages)</option>
            </select>
          </div>
          <div class="space-y-2">
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Voice</p>
            <div class="flex flex-col gap-2 text-sm text-slate-700">
              <label class="flex items-center gap-2">
                <input type="radio" name="speech-voice" value="female" class="accent-[#0052C4]" checked>
                Heart (Female)
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="speech-voice" value="male" class="accent-[#0052C4]">
                Fenrir (Male)
              </label>
            </div>
          </div>
          <div class="space-y-2">
            <p class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Speed</p>
            <select id="speech-speed" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-[#0052C4]/40">
              <option value="1">1x (Normal)</option>
              <option value="1.5">1.5x (Fast)</option>
              <option value="2">2x (Very fast)</option>
            </select>
          </div>
          <p class="text-[11px] text-slate-500 leading-relaxed">Tip: Choose browser speech for multilingual playback.</p>
        </div>
      </div>
      <button onclick="alert('I can only answer questions based on the SPX102 Notes.')" class="p-2 text-slate-500 hover:text-slate-900 transition-colors rounded-full hover:bg-slate-100" aria-label="Information about the chatbot">
        <i data-lucide="info" class="w-5 h-5"></i>
      </button>
    </div>
  </header>

  <!-- Chat Log -->
  <main id="chat-log" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-6 scroll-smooth bg-white">

    <!-- Focus Toggles -->
    <section class="bg-slate-50 border border-slate-200 rounded-2xl p-4 shadow-sm space-y-3">
      <p class="text-sm text-slate-700">Select none, one or both to make the chatbot focus on sports, clinical or sports-related clinical examples</p>
      <div class="flex flex-wrap gap-3">
        <button id="clinical-toggle" type="button" class="focus:outline-none relative overflow-hidden rounded-xl border border-slate-200 bg-white transition hover:-translate-y-0.5 hover:border-[#0052C4]/70 active:scale-[0.99] p-2 shadow-sm">
          <img src="./clinical.png" alt="Clinical focus" class="w-24 h-24 object-cover rounded-lg" />
          <span class="sr-only">Toggle clinical focus</span>
        </button>
        <button id="sports-toggle" type="button" class="focus:outline-none relative overflow-hidden rounded-xl border border-slate-200 bg-white transition hover:-translate-y-0.5 hover:border-[#0052C4]/70 active:scale-[0.99] p-2 shadow-sm">
          <img src="./sports.png" alt="Sports focus" class="w-24 h-24 object-cover rounded-lg" />
          <span class="sr-only">Toggle sports focus</span>
        </button>
      </div>
    </section>
    
    <!-- Welcome Message -->
    <div class="flex gap-4">
      <img src="./ross pic.png" class="w-10 h-10 rounded-full object-cover border border-slate-200 flex-none self-end mb-1" alt="Bot">
      <div class="space-y-1 max-w-[85%]">
        <div class="text-xs text-slate-500 ml-1">Ro(bot)ss Clark</div>
        <div class="msg-bot bg-white border border-slate-200 p-4 text-sm leading-relaxed shadow-sm text-slate-800">
          <div data-role="bot-content">
            <p>Hello! I'm your AI assistant for <span class="text-[#0052C4] font-semibold">SPX102 INTRODUCTION TO COACHING</span>.</p>
            <br>
            <p>I can help you understand coaching pedagogy, training principles and other aspects of your course. What should we discuss?</p>
          </div>
          <div data-role="followup-container" class="mt-3 flex flex-wrap gap-2 hidden"></div>
        </div>
        <div class="mt-2 flex items-center gap-2 text-xs text-slate-500">
          <button type="button" class="copy-button inline-flex h-8 w-8 items-center justify-center rounded-full shadow-sm" data-role="copy-button" aria-label="Copy message text" title="Copy text">
            <i data-lucide="copy" class="w-4 h-4"></i>
          </button>
          <span>Copy</span>
        </div>
      </div>
    </div>

  </main>

  <!-- Typing Indicator (Hidden by default) -->
  <div id="typing-indicator" class="hidden px-4 pb-2">
    <div class="flex gap-4">
      <img src="./ross pic.png" class="w-8 h-8 rounded-full object-cover border border-slate-200 flex-none self-end opacity-70" alt="Bot">
      <div class="msg-bot bg-slate-100 border border-slate-200 p-3 rounded-2xl rounded-bl-none w-16 flex items-center justify-center h-10">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <footer class="flex-none p-4 bg-white backdrop-blur-lg border-t border-slate-200">
    <form id="chat-form" class="max-w-4xl mx-auto relative flex items-end gap-2">
      
      <div class="relative flex-1 bg-slate-50 border border-slate-200 rounded-2xl focus-within:ring-2 focus-within:ring-[#0052C4]/40 focus-within:border-[#0052C4] focus-within:bg-white transition-all duration-300 shadow-sm">
        <textarea
          id="user-input"
          rows="1"
          class="w-full bg-transparent text-slate-900 placeholder-slate-400 px-4 py-3.5 outline-none resize-none overflow-hidden max-h-32 text-sm"
          placeholder="Ask a question about coaching..."
          oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px'"></textarea>
      </div>

      <div class="flex flex-col items-center gap-1">
        <button
          type="button"
          id="pdf-btn"
          class="flex-none h-[50px] w-[50px] border border-slate-200 bg-white text-slate-700 hover:text-[#0052C4] rounded-full flex items-center justify-center shadow-sm transition-all hover:scale-105 active:scale-95"
          aria-label="Attach PDF">
          <i data-lucide="paperclip" class="w-5 h-5"></i>
        </button>
        <input id="pdf-input" type="file" accept="application/pdf" class="hidden" />
        <div class="flex items-center gap-1">
          <span id="pdf-label" class="text-[10px] text-slate-500 text-center leading-tight">PDF</span>
          <button
            type="button"
            id="pdf-clear"
            class="hidden text-slate-400 hover:text-slate-700 transition-colors"
            aria-label="Remove PDF">
            <i data-lucide="x" class="w-3 h-3"></i>
          </button>
        </div>
      </div>

      <div class="flex flex-col items-center gap-1">
        <button
          type="button"
          id="mic-btn"
          class="flex-none h-[50px] w-[50px] border border-slate-200 bg-white text-slate-700 hover:text-[#0052C4] rounded-full flex items-center justify-center shadow-sm transition-all hover:scale-105 active:scale-95"
          aria-label="Toggle microphone mode">
          <i data-lucide="mic-off" class="w-5 h-5"></i>
        </button>
        <span id="mic-mode-label" class="text-[10px] text-slate-500 text-center leading-tight">Speech off</span>
      </div>

      <button 
        type="submit" 
        id="send-btn" 
        class="flex-none h-[50px] w-[50px] bg-[#0052C4] hover:bg-[#1a73e8] text-white rounded-full flex items-center justify-center shadow-lg shadow-blue-500/30 transition-all hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
        <i data-lucide="send" class="w-5 h-5 ml-0.5"></i>
      </button>

    </form>
    <div class="text-center mt-2">
       <span id="error" class="text-xs text-red-400 font-medium"></span>
       <span class="text-[10px] text-slate-500">I can only answer questions based on the SPX102 INTRODUCTION TO COACHING notes I was given.</span>
    </div>
  </footer>

  <div class="bottom-safety-pad flex-none w-full" aria-hidden="true"></div>

  <script>
    // Initialize Icons
    lucide.createIcons();

    const API_URL = "/.netlify/functions/openrouter-chat"; // Original Backend URL
    const HF_TTS_API = "/.netlify/functions/hf-tts";
    const HF_TTS_VOICES = {
      female: "af_heart",
      male: "am_fenrir",
    };
    const chatLog = document.getElementById("chat-log");
    const form = document.getElementById("chat-form");
    const textarea = document.getElementById("user-input");
    const errorSpan = document.getElementById("error");
    const sendBtn = document.getElementById("send-btn");
    const typingIndicator = document.getElementById("typing-indicator");
    const clinicalToggle = document.getElementById("clinical-toggle");
    const sportsToggle = document.getElementById("sports-toggle");
    const micBtn = document.getElementById("mic-btn");
    const micModeLabel = document.getElementById("mic-mode-label");
    const pdfBtn = document.getElementById("pdf-btn");
    const pdfInput = document.getElementById("pdf-input");
    const pdfLabel = document.getElementById("pdf-label");
    const pdfClearBtn = document.getElementById("pdf-clear");
    const downloadBtn = document.getElementById("download-chat");
    const speechOptionsToggle = document.getElementById("speech-options-toggle");
    const speechOptionsPanel = document.getElementById("speech-options-panel");
    const speechEngineSelect = document.getElementById("speech-engine");
    const speechSpeedSelect = document.getElementById("speech-speed");
    const speechVoiceInputs = document.querySelectorAll("input[name='speech-voice']");

    // Full message history
    let messages = [];
    let focusState = { clinical: false, sports: false };
    let pendingFocusInstruction = "";
    let activeAudio = null;
    let globalAudioElement = new Audio();
    let activeTtsButton = null;
    let activeUtterance = null;
    let lastUserPrompt = "";
    let narrativeModeEnabled = false;
    let narrativeModeInFlight = false;
    const ttsSpeedOptions = [1, 1.5, 2];
    let ttsSpeed = 1;
    let ttsEngine = "huggingface";
    let ttsVoice = "female";
    let ttsPlaybackToken = 0;
    let availableVoices = [];
    let autoTtsEnabled = false;
    let pdfAttachment = null;

    // --- SPEECH RECOGNITION ---
    const SpeechMode = { OFF: 0, PUSH_TO_TALK: 1, CONTINUOUS: 2 };
    const speechModeLabels = ["Speech off", "Push-to-talk", "Continuous (auto-pause)"];
    const RecognitionClass = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognitionSupported = Boolean(RecognitionClass);
    let recognition;
    let isListening = false;
    let speechMode = SpeechMode.OFF;
    let speechBuffer = "";
    let activeTtsContentEl = null;
    let silenceTimer = null;
    let pausedForResponse = false;
    let pausedForTts = false;
    let awaitingResponse = false;
    let lastFinalTranscript = "";

    // --- KNOWLEDGE BASE (Restored) ---
    const knowledgeBase = `
## Assessment Tasks

### Task 1A – Coaching Knowledge & Conduct Modules (Weight: 10%, Due: Friday Week 4)
- Complete 4 online modules:
  - Play by the Rules (PBTR): Safeguarding Children and Young People in Sport Induction; Harassment and Discrimination.
  - Australian Sport Learning Centre: Community Coaching – Essential Skills; Community Officiating – General Principles.
- Submission: Save certificates (or screenshots), combine into a single PDF or Word file, and upload to Canvas.
- Goal: Demonstrate understanding of core coaching knowledge and professional conduct.

### Task 1B – Design a 1-Hour Coaching Session Plan (Weight: 20%, Due: Friday Week 8)
- Design a structured 1-hour lesson plan for any sport, event, or clinical condition using the provided template.
- Choose any sport recognized by the Australian Sports Commission.
- Format: PDF (preferred) or Word.
- AI Policy: Generative AI is allowed if used critically and acknowledged with a written declaration.
- Note: Attend the Week 6 workshop for feedback.

### Task 2 – Physical Capacity Testing (Weight: 50%, Due: Friday Week 13)
- Weeks 8–12: Perform one field-based physical test per week in scheduled labs with you as the coach.
- Submission:
  1. Video: One video of your best performance implementing a test with fellow students.
  2. Written Report: Max 400-word reflection on your coaching performance using the provided template.
- Goal: Implement, record, and analyse a field-based fitness test.
- Note: If you cannot record in class during Weeks 8–12, contact the Course Coordinator by Week 8.

### Task 3 – Centrally-Scheduled Exam (Weight: 20%, Exam window: TBD)
- Duration: 2 hours, fully online, open book; must be completed in one sitting once started.
- Content: Multiple choice and short answer questions covering theoretical content from the entire semester.
- AI Policy: AI is allowed.
- Warning: Do not start after 3pm on the Wednesday closing day to allow the full 2-hour window.

---
### Weekly Course Content
# Week 1: The Role of the Coach and Official

## Introduction to SPX 102: Introduction to Coaching Science
* Watch the welcome video for administrative information (assessment tasks, textbooks, attendance).
* Pre-recorded materials cover theoretical aspects and should be watched before tutorials to consolidate understanding in face-to-face labs.
* This week's topic: Coaching and officiating, and their respective roles.
* Pre-recordings are split into several parts, each around 20 minutes.
* Acknowledgement of traditional custodians of the land.

## Course Learning Outcomes
* Understand what you will be able to do by the end of the course to guide your attention.
* Outcomes are modeled around industry standard competencies (e.g., ESSA standards).
* **Examples of prominent competencies:**
    * Apply basic testing to athletes (e.g., anthropometric and field-based testing, interpreting results). This is important for coaches and clinicians.
    * Plan and implement a basic coaching session (determine skill, design effective session, incorporate progressions/regressions, deliver information).
* Read through all expected understandings by the end of the course in your own time.

## Key Themes/Framework for Coaching
* Coaching is not a one-size-fits-all approach; adjustments are often needed based on context and individual needs.
* **Themes to help adjust your framework:**
    * **Specificity:** Training adaptations are specific to the way training is conducted (e.g., sprinters vs. marathon runners).
    * **Individuality:** Adjust training programs based on individual needs and preferences (e.g., preferred learning modalities).
    * **Planning:** Crucial for coaching sessions, especially for assessment tasks involving session design and skill teaching.
    * **Communication:** Style needs to change based on athlete's age, developmental stage, or presence of physical/cognitive disabilities.
    * **Monitoring:** Tracking key variables across the training program.
    * **Inclusion:** Maximizing athlete involvement in training programs.

## Role of the Coach
* The main role of a coach is to enhance the performance of an athlete or team.
* **Performance** means executing a skill in a specific context. Coaches help improve this execution.
    * Examples in soccer: improving passing accuracy, shooting accuracy, defensive structure.
* Performance has physical, cognitive, psychological, and emotional components.
* Coaches identify when performance declines under pressure (e.g., in a game scenario) and improve skill transfer from training to competition.
* **How coaches achieve performance enhancement:**
    * Teaching
    * Facilitating appropriate practice
    * Providing feedback
* Coaches must be great communicators:
    * Understand how people learn.
    * Identify performance deficiencies.
    * Develop instructions and activities to address shortcomings.
    * Communicate information clearly for athlete understanding.
* Being able to pass on information is more important than executing performance oneself.
* Great players may not be great coaches if they cannot identify deficiencies and communicate solutions.
* Coaches act as **guides and facilitators**, encouraging athletes to arrive at conclusions themselves to develop robust motor programs and consolidate skills. Explicit instruction is sometimes needed.

## Understanding Learning Modalities
* It's important to understand how athletes prefer to learn.
* A questionnaire can help identify individual learning preferences.
* **Types of learners:**
    * **Visual learners:** Need to see things (graphs, pictures).
    * **Auditory learners:** Prefer to listen.
    * **Reader/Writer learners:** Take extensive notes.
    * **Kinesthetic learners:** Learn by feel; need to feel the correct body position for skill execution.
* Most people prefer **multimodal learning** (combining two or three modes).
    * Example: Combining kinesthetic feedback (adjusting body position) with visual feedback (power output graphs).
* Catering delivery of information to learning preferences improves retention.

## The Learning Process Blueprint
* Teaching/communicating information is a small part of the learning process, which is a continuous loop.
* **Stages of the learning process (within a single training session and across training blocks):**
    1.  **Instruction:** Verbal instruction and communication of information.
    2.  **Practice/Execution:** Athletes perform the instructed activity/skill.
    3.  **Feedback/Reflection:** Opportunity for feedback.
    4.  **Learning Effect/Maladaptation:** Hopefully a positive learning effect occurs.
    5.  **Retention/Consolidation:** Skill is retained, potentially leading to more advanced components and restarting the process.
* **Importance of positive learning effects:**
    * Well-developed motor patterns are difficult to unlearn.
    * Coaches must optimize the learning process to ensure positive adaptation and avoid maladaptation (negative learning effect).
* This process applies to physical preparation within training blocks (e.g., pre-season aerobic capacity development).

## Delivering Effective Verbal Instructions (for Peer Coaching Assessment)
* Coaches must deliver verbal instructions effectively.
* **Tips for effective verbal instructions:**
    * **Communicate the general idea:** Focus on goal-directed instruction, allowing individual interpretation.
    * **Use short, simple, focused instructions:** Employ keywords and appropriate terminology for the audience (e.g., adjust for age groups).
    * **Key words are reminders of technique, not just encouragement:** (e.g., "open foot" for soccer passing).
    * **Clear and projected voice:** Practice improves confidence and projection.
    * **Accurate, useful, and timely feedback:**
    * **"Sandwich approach" for feedback:** Good point, area for improvement, another good point. This builds confidence while highlighting areas for growth.
    * **Check for understanding:** Ask athletes to demonstrate, explain the task, or use open-ended questions.
    * **Minimize time between instruction and practice:** Short-term memory limits information retention.
    * **Avoid information overload:** Focus on one or two key points at a time.
    * **Avoid pointing out "what not to do":** This can confuse athletes.

## Using Demonstrations Effectively
* Demonstrations can be very effective for delivering information, especially when introducing a skill.
* They deliver a lot of information simply and can prevent verbal overload.
* Use demonstrations sparingly *after* initial instruction to avoid reliance.
* **Key principles for demonstrations:**
    * **Must be performed correctly:** Incorrect demonstrations lead to incorrect motor programs. Can use other athletes, pictures, diagrams, or videos.
    * **Ensure visibility:** Be aware of environmental factors (e.g., sun).
    * **Accompany with verbal instructions:** Use verbal cues to highlight important parts or keywords.
    * **Show in a game context when possible:** Skills differ in isolation versus competition.
    * **Show at normal speed (beginning and end):** This ensures understanding of appropriate timing, even if slowing down for complex parts.
    * **Break down complex skills into smaller parts or slow them down:** Allows focus on important aspects.
    * **Avoid pointing out "what not to do."**
    * **Allow immediate practice:** Relates to short-term memory retention.

## Types of Feedback
* Feedback type adjusts based on skill, developmental stage, and sport.
* **Broad categories of feedback:**
    * **Task Intrinsic Feedback:** Information available to the athlete *during* performance.
        * Sensory information: visual, auditory, proprioceptive (body's position in space), tactile (touch).
        * Coaches highlight important pieces of task intrinsic information.
    * **Augmented Feedback:** Information the athlete does *not* have access to during the task, usually from the coach.
        * **Knowledge of Results (KR):** The simple outcome of the task (e.g., "Did you hit the target?").
        * **Knowledge of Performance (KP):** How the result was achieved (e.g., "good release velocity," "shoulder range of motion").
            * Use KP carefully with higher-level athletes who can utilize complex information; it can confuse younger/less developed athletes.

## Developing an Effective Practice Session
* **Framework for effective practice:**
    * **Enjoyment:** Engages athletes, improves information retention.
    * **Good Preparation:** Plan ahead, set up equipment, quickly divide groups.
    * **Clear Goal and Objectives:** Sessions should have a defined purpose (e.g., teach passing, shooting). Goals can have physical and cognitive components.
    * **Challenging but Achievable Tasks:** Tasks need a certain difficulty level for engagement and learning.
        * Rough guideline: Athletes achieve goal 50-70% of the time.
    * **Appropriate Progressions and Regressions:** Be able to adjust activities on the fly to cater to the group's needs.

## The Coaching Process (Iterative Blueprint)
* The coaching process involves continuous reflection and modification.
* **Cycle:**
    1.  Plan and organize a session.
    2.  Observe the session.
    3.  Analyze outcomes.
    4.  Adapt for the next time.
    5.  Ask athletes for feedback.
    6.  Use feedback to improve performance.
    7.  Reflect on new athlete needs and continue the cycle.
* Continually modify training practices for good outcomes.

## Questions for Effective Reflection
* Did the session achieve its goal? (Measure by enjoyment/engagement, performance improvement, learning).
* What went well? (Were planned activities effective? Too easy/difficult? Did progressions/regressions work?).
* What might you change for next time? (More difficult activity? Different activity?).
* How are athletes responding? (Physical soreness, engagement levels).
* How can you deliver information in another way? (Recognizing varied learning styles).

## Coach Development
* Coaches need a mindset of **lifelong learning** to continually develop knowledge, competence, and ethics.
* **Knowledge needed to enhance performance:**
    * **Sport/Skill Knowledge:** Technical, tactical, physiological conditioning, rules and regulations. This is a long process.
    * **Sports Science/Coaching Theories:** How people learn, best delivery methods, designing small-sided games for holistic development.
    * **Knowledge of the Athlete:** Adapt coaching to individual needs.
    * **Knowledge of Context/Situation:** Alter coaching style based on circumstances.

## Old-School vs. Modern Coaching Approaches
* **Old-School (20th Century):**
    * Teaching skills in isolation.
    * Explicit instructions (telling athletes exactly what to do).
    * Heavy reliance on the coach.
* **Modern Approach:**
    * Coach acts as a **facilitator or guide**.
    * Provides implicit instructions, guiding athletes to the right outcome.
    * Helps develop a more robust motor program.
    * Uses a **games-based approach** (often).
    * Empowers athletes to become **problem solvers**; reduces reliance on the coach during competition.

## The Role of the Official

## Definition of an Official
* An official is someone who helps **control or govern competition or gameplay**.
* Specifically, an official controls gameplay by applying laws and rules of the sport to make judgments on rule infringements, performance, time, or score.
* A primary role is to ensure competition remains fair, requiring a strong knowledge of rules and regulations.

## Three Key Roles of Officials
1.  **Control the game:**
    * Ensure the game is played in the spirit of sport (fairly, without malice).
    * "Losing control" occurs when poor decisions are made, often due to a lack of rule understanding or inability to recall rules quickly.
2.  **Decision-making:**
    * Must make decisions quickly, accurately, and objectively.
    * Requires recalling rules from memory and applying them to rapid situations (infringements can occur in fractions of a second).
3.  **Communication:**
    * Needs to communicate decisions to athletes, explaining *why* the decision was made to prevent repeat mistakes.

## Other Key Roles of Officials
* **Risk Managers:**
    * Patrol fields before games to ensure safety (e.g., wet weather).
    * Appropriately enforce rules to maintain standards and manage player behavior.
* **Ethical Behavior:** Must behave ethically at all times.
* **Conflict Management:** Must be good at managing conflicts.
* **Administrators:** Must be good administrators.

## Types of Officials (Continuum)
* Officials are categorized based on interaction with athletes, movement demands, and number of cues to observe/track.
* **Interactors:**
    * High levels of interaction and physical movement.
    * Large number of cues to process.
    * Examples: Football (soccer), basketball, other football codes.
* **Monitors:**
    * Low to medium interaction and physical demands.
    * Often a large number of cues to monitor (cognitively demanding).
    * Examples: Gymnastics judge, volleyball referee.
* **Reactors:**
    * Low interaction and movement demands.
    * Low to medium number of cues to track.
    * Example: Tennis line judge (deciding "in" or "out").

## Cognitive Process of Officiating
* Officials should be thought of as athletes requiring training and preparation.
* **Decision-making cognitive process:**
    1.  **Stimulus:** An event occurs (e.g., a player's tackle).
    2.  **Perception:** Official observes the stimulus.
    3.  **Decision/Categorization:** Determine if it falls within/outside rules (e.g., foul or not).
    4.  **Access Information (Long-term memory):** Recall laws of the sport, prior experiences, prior episodes with players.
    5.  **Integration:** Assess the severity of the event against stored knowledge.
    6.  **Behavioral Response:** Take action (e.g., award a free kick, issue a red card).
* This is a complicated process involving perceiving, comparing with memory, and making quick decisions.
* Understanding this process helps prepare officials for better officiating.

## Factors Affecting Official Decision-Making
* **Factors that impair decision-making:**
    * **Time constraints:** More challenging in fast-paced sports (e.g., cricket, tennis).
    * **Physical exertion:** Fatigue from covering large distances can affect decision-making (relevant in team/field sports).
    * **Hot, humid environments:** Can result in slower reaction times.
* **Factors that improve decision-making:**
    * Appropriate diet.
    * Adequate sleep.
    * Physical fitness.

## Preparation and Screening of Officials
* Treat officials like athletes; they should be trained and screened regularly.
* **Required screening and training:**
    * **Cognitive training and performance analysis:** Assess correct decision-making under pressure.
    * **Fitness monitoring:** Ensure physical requirements to keep up with play.
    * **Regular medical status and health checks:** Ensure physical fitness for officiating.
    * **Musculoskeletal checks:** Check joints and muscles for health and ability to cope with physical demands.
    * **Visual and hearing testing:** Crucial sensory information for accurate decision-making.
* While some sports have fitness tests, sensory tests are less common despite their importance.

# Week 2: Talent Identification and Performance Testing

## Introduction to Talent Identification and Performance Testing
* This week focuses on talent identification and performance testing.
* Information is relevant for labs where performance testing will be conducted.
* Topics include sensitivity, reliability, and validity of tests.
* Pre-recording covers types of tests and the performance capacities they represent.
* Part one: Introduction to talent identification testing and athlete performance testing, including purpose, subtypes of talent ID, and blueprint for a talent ID model.
* Part two: Tests for specific performance characteristics (e.g., speed, power, endurance), and a discussion on reliability and validity.
* Part three: Kinanthropometry, which is the measure of body segment lengths and their relationship with performance in specific sports.

## Defining Talent Identification
* Talent identification involves identifying individuals who show promise in a particular sport or activity.
* These individuals are then recruited into a formal training program.
* This process is common in schools, clubs, and representative competitions.

## Subtypes of Talent Identification
1.  **Talent Selection:**
    * Involves identifying talented athletes who are *already participating* within a specific sport.
    * Examples include progression through school, district, regional, state, and national competitions.
    * Athletes identified at state or national levels may be selected into institutes of sport.
2.  **Talent Detection:**
    * Involves recruiting athletes from an *outside sport* who possess suitable skills or attributes for high performance in another sport.
    * These attributes are often anthropometric variables (body type, e.g., limb segment lengths) or performance variables.
    * For example, long legs might indicate suitability for long jump or high jump.
3.  **Talent Transfer:**
    * (Note: While mentioned as a subtype, the provided transcripts for Part I do not elaborate on Talent Transfer. The detail focuses on Selection and Detection.)

## Physical Testing Batteries and Draft Combines
* Physical testing batteries, such as draft combines, are used to test for specific physical characteristics.
* These combines are a form of talent selection, where athletes (e.g., from college systems) undergo trials for professional teams (e.g., NBA, NFL).
* The process involves identifying important physical or performance attributes relevant to a specific sport.

## Reliability and Validity in Testing
* **Reliability:** Refers to how well a measurement is reproduced or how consistent it is.
    * Ensures consistent results under the same conditions.
    * Example: If height measurements vary significantly at the same time each day, the tool is not reliable.
    * To control for reliability, tests should be standardized: taken at the same time of day, using the same protocols, conditions, equipment, and by the same person.
* **Validity:** Refers to whether a measurement tool actually measures what it is intended to measure.
    * It's the agreement between the measured value and its true value.
    * Example: If a height measurement tool consistently reads 160 cm for someone who is 180 cm tall, it's not valid.
    * In sports performance and talent identification, field-based tests are often developed, and their validity is a key consideration.
* Ensuring both reliability and validity is crucial for accurate and good measures.
* **Example using GPS:**
    * A GPS unit consistently measuring 75 meters for a known 50-meter distance is reliable but not valid (consistent but inaccurate).

## Kinanthropometry
* Kinanthropometry is the measure of body limb segment lengths and girths, and the ratios of these lengths to one another (e.g., leg length to trunk length).
* It looks at how these measurements relate to advantageous performance in specific sports.
* **Anthropometry** (body type, dimensions, composition, and structure) is affected by:
    * **Genetics:** Different body types across ethnicities.
    * **Biological Age:** Changes through puberty (muscle mass, height, limb length).
    * **Sociological and Cultural Factors:** Nutrition significantly impacts anthropometry; insufficient energy intake during growth can prevent full growth potential.

### Specific Anthropometric Measures
1.  **Bone Growth/Length:**
    * Important for youth athletes to track high growth rates and ensure normative bone growth.
    * Can be measured simply with a tape measure using bony landmarks (low cost, non-invasive).
    * More accurate methods include X-rays.
2.  **Bone Density:**
    * Measures bone thickness; thicker bones are more resistant to damage from repeated impact (e.g., preventing stress fractures).
    * Measured with CAT scans, MRI, and DEXA scans (requires expertise).
3.  **Height:**
    * Useful for talent identification and youth athlete monitoring.
    * **Peak Height Velocity (PHV):** The growth spurt where young athletes experience rapid increases in height linked to puberty.
    * During PHV, it may be necessary to reduce training loads and increase energy intake to support growth and reduce overuse injury risk.
    * Simple to measure using a stadiometer.
    * Being tall offers advantages in many sports, most notably basketball.

# Week 3: Training Principles

## Introduction to Training Theory and Methodology
* This week covers the theory and methodology of training, specifically training principles.
* It will introduce FIT principles and broadly discuss the training and adaptation process, including super compensation.
* The goal is to guide how to design and schedule training to improve physical capacities and help athletes peak at the right time.

## Training and Adaptation Process: Super Compensation
* Super compensation describes the time cycle of how the body adapts post-exercise or post-training.
* This principle helps guide when to schedule the next rigorous training session to achieve improvements in physical performance and ensure athletes peak at optimal times.

## Training Principles Overview
The main training principles discussed are:
* **Overload:** How much training is being done, and how to modify variables to achieve different amounts of training.
* **FIT Principles (Frequency, Intensity, Time/Duration, Type):** These are variables within the overload principle that can be manipulated to achieve appropriate overload.
* **Specificity:** Adaptations from training are specific to the way training is performed. To improve competition performance, training needs to mimic competition to some extent. For example, long-distance runners need to do long running, not sprint training.
* **Individuality:** Different athletes will adapt in different ways and magnitudes to the same mode and amount of exercise.
* **Reversibility:** "Use it or lose it" – if a specific physical capacity is not continuously trained, it will reduce over time.
* **Recovery:** Crucial between training sessions to maximize adaptations.

## Overload and Measuring Workload
* Workload is a combination of how often and how hard an athlete is training.
* It's crucial to measure workload to understand "how much is too much" and its association with performance and injury prevention.
* Coaches need to know if athletes are training hard enough or too hard, as overtraining can be detrimental to long-term performance.

### Variables to Manipulate Training Load (FIT Principles)
1.  **Frequency:** The number of training sessions per week. Reducing sessions decreases training load. Sometimes limited by team schedules for amateur athletes.
2.  **Intensity:** How difficult the training session is. Increasing or decreasing intensity increases or decreases training load. Measuring intensity can be simple.
3.  **Time/Duration:** How long the training session lasts. Increasing or decreasing duration impacts training load. Easily measured with a watch.
4.  **Type:** Refers to specific actions or drills. Associations exist between increases in specific actions (e.g., cricket bowls, running speeds) and injury risk. Modifying the number of specific actions (e.g., shooting drills for 10 vs. 15 minutes) can increase or decrease training load.

Many of these variables are simple to measure and modify, allowing for easy adjustment of training load.

## Individuality in Depth
* Athletes adapt differently to the same training due to various factors.
* **Performance Strengths and Weaknesses:** Athletes have varying muscle mass, strength, and speed, leading to different adaptations to training types.
* **Base Fitness Levels and Responsiveness:** Athletes with higher base fitness might recover better from certain training modes.
* **Tolerance and Recovery to Training/Competition:** Individuals experience different levels and durations of soreness post-competition. Subjective wellness monitoring (e.g., questionnaires for soreness) helps track this.
* **Environmental Tolerances:** Body composition (e.g., high body fat as an insulator) affects temperature regulation in hot/humid environments, influencing recovery.
* **Age:**
    * Younger athletes, especially during puberty and growth spurts (Peak Height Velocity), have increased energy demands. Overloading during these periods risks overuse or overtraining injuries.
    * Older athletes with a larger training history can typically handle higher weekly training volumes.
* **Gender:** Biological males and females may adapt differently to training modes, requiring considerations for modifying training volumes.
* **Training Preferences:** Athletes may dislike exercises, even effective ones. Coaches should adapt exercises or choose alternatives, as some exercise is better than none.
* **Lifestyle and Social Variations:** Work, family, and other commitments require coaches to program training around these, potentially including deloading weeks during demanding periods.

The coach's role is to understand these factors and program training effectively to consider all of them.

## Reversibility
* The principle of reversibility means "use it or lose it." If an athlete stops training a specific physical capacity, that capacity will decrease over time.

## Recovery
* Recovery is crucial between training sessions for maximizing adaptation.
* Factors like nutrition and sleep are fundamental for recovery before considering additional modalities.
* **Common Recovery Modalities:**
    * **Cold water immersion:** Evidence suggests improvement in jump performance and strength in days following exercise.
    * **Compression garments:** Similar evidence for improving jump performance and strength.
* These modalities can have a small, beneficial effect on certain variables, which can be important at high levels of competition.

# Week 4: Training Capacities

## Introduction to Training Capacities
* This week talks about specific training capacities and how best to train them.
* It follows last week's discussion on training principles and manipulating variables to influence training load and intensity.
* Capacities discussed include stamina/endurance, strength, speed, flexibility/mobility, and skill (physical and mental components).

## Endurance (Stamina)
* **Definition:** The ability to continue to generate energy and minimize speed loss over distance and time.
* **Associated Sports:** Typically associated with sports requiring low to moderate exercise intensities for long periods, such as marathon running, rowing, and AFL.
* **Training Endurance:**
    * **Long-Distance Interval Training:** Can involve continuous running for long periods at a moderate intensity.
    * **Repeat Sprints:** Can also be used to train endurance capacity.
    * **Small-Sided Games:** Current practice in many team sports to train endurance capacity within games. Manipulating field size (wider/narrower) changes physical outputs, allowing players to cover larger distances on bigger pitches, thus training endurance while also refining technical skills.

## Strength
* **Definition:** Maximal strength refers to how much weight one can lift or how much force one can produce.
* **Importance:** Crucial for various sports, including powerlifting, Olympic lifting, football codes (rugby league, union, AFL) due to tackling, martial arts, and gymnastics for body weight movements and grappling. Certain levels of strength are essential for effective participation in some sports (e.g., tackling players with high body mass in rugby).
* **Relationship with Power:** Strength is related to power development. Power is the rate of doing work (force x velocity), meaning how quickly strength can be expressed. You need strength to develop power.
* **Types of Strength:**
    * **Maximal Strength:** How much force can be produced regardless of time (e.g., one-rep max).
    * **Strength Endurance:** The ability to repeat strong actions (e.g., throwing punches repeatedly).
    * **Relative Strength:** Strength relative to body mass (important in sports like gymnastics or sprinting where high body weight can be a disadvantage).
    * **Absolute Strength:** Strength without considering body mass (important in sports like powerlifting).
* **Training Strength:**
    * **Resistance Training:** Primarily trained via resistance exercises.
    * **Key Variables for Program Design:**
        * **Sets and Repetitions:** How many sets and how many repetitions per set.
        * **Weight/Resistance:** How heavy the weight is.
        * **Rest Periods:** Time between sets.
        * **Frequency:** How often training is performed.
    * **Training Goals (Hypertrophy, Strength, Power, Endurance):** Different combinations of sets, repetitions, and rest periods target different adaptations.
        * **Hypertrophy (Muscle Growth):** Typically 6-12 reps.
        * **Strength:** Typically 1-6 reps.
        * **Power:** Typically 1-5 reps at high velocity.
        * **Endurance:** Typically 12-20+ reps.

## Speed
* **Definition:** Refers to maximal running speed, or other forms of maximal speed like cycling or swimming speed.
* **Factors Influencing Speed:**
    * **Stride Length:** The distance covered with each stride.
    * **Stride Frequency:** How many strides are taken per unit of time.
    * **Relationship:** Speed = Stride Length x Stride Frequency. Increasing either can increase speed.
* **Improving Stride Length:** Requires adequate hip mobility/flexibility, as greater hip extension and flexion can increase stride length. Also requires sufficient propulsive forces.
* **Improving Stride Frequency:** Requires fast twitch muscle fibers and a high rate of force development.
* **Training Speed:**
    * **Interval Training:** Performing repeated short, maximal efforts with full recovery. Examples: Flying 20s or 30s sprints (maximal speed over a short distance).
    * **Resistance Training:** Can improve speed by enhancing propulsive forces and rate of force development, which contributes to both stride length and frequency.
    * **Plyometrics:** Explosive exercises (e.g., box jumps, hopping, bounding) that involve a rapid eccentric (lengthening) contraction followed by a rapid concentric (shortening) contraction. Improves rate of force development.
    * **Agility Training:** Focuses on quick changes in direction. Important for team sports. Requires training perception and decision-making in response to environmental factors.

## Flexibility and Mobility
* **Definition:** Refers to the range of motion around a single or multiple joints. The farther a joint can move through its range of motion, the more flexibility or mobility.
* **Importance:** Crucial for sports like gymnastics and dance, and important for increasing stride length in sprinting (good hip range of motion).
* **Factors Affecting Flexibility:**
    * **Joint Structure:** Some joints are inherently more flexible than others.
    * **Muscle Properties:** Viscoelasticity (ability to return to original shape) and plasticity (ability to maintain a new shape).
    * **Age:** Flexibility tends to decrease with age.
    * **Gender:** Females generally have greater flexibility than males.
    * **Genetics:** Innate differences in flexibility.
    * **Activity Levels:** Regular stretching or activity can maintain/improve flexibility.
    * **Temperature:** Muscle temperature (e.g., warm-up) can temporarily increase flexibility.
* **Training Flexibility:**
    * **Static Stretching:** Holding a stretch for a period (e.g., 30-60 seconds). Most common form.
    * **Dynamic Stretching:** Movement-based stretches (e.g., leg swings, arm circles).
    * **PNF (Proprioceptive Neuromuscular Facilitation):** Involves contracting and relaxing muscles to increase range of motion.
    * **Importance:** Stretching is most effective when muscles are warm. Dynamic stretching is often recommended before exercise, and static stretching after, or as a dedicated session.

## Skill
* **Definition:** The ability to perform movement efficiently and consistently. Involves both physical and mental components.
* **Physical Components:** Good technique, coordination, balance, and agility.
* **Mental Components:** Decision-making, anticipation, and attentional focus.
* **Characteristics of Highly Skilled vs. Less Skilled Performers:**
    * **Highly Skilled:**
        * More accurate and consistent movements.
        * More efficient, requiring less energy (high movement economy).
        * Perform with better timing.
        * Better perception and quicker processing of environmental factors, leading to quicker reactions.
        * Have more automated skills, requiring less conscious thought, freeing up cognitive resources to focus on tactics and decision-making (e.g., where to pass).
    * **Less Skilled:**
        * Less consistent movements.
        * Less efficient, expending more energy.
        * Slower processing of information, leading to slower reactions.
        * Require more attentional demands for basic skill execution.
* **Training Skill:** Best trained through practice. Practice should be:
    * **Repetitive:** To automate movements.
    * **Variable:** To prepare for different game situations.
    * **Contextual:** Mimicking game conditions.
    * **Pressure-Based:** To improve performance under stress.
* **Coupling Training Capacities (General Guidelines):**
    * **Strength and Speed/Power:** Can be effectively trained together, ideally with at least 4-6 hours rest between sessions (e.g., morning strength, afternoon speed). Low-volume strength training is appropriate for sprinting.
    * **Endurance with Speed/Strength/Power:** Very difficult to train optimally together. Best to target endurance sessions in different training blocks or on separate days to minimize interference.

# Week 5: Training, Planning, and Programming

## Introduction to Training, Planning, and Programming
* This week covers how to design both short- and long-term training programs for athletes.
* The topic includes quadrennial (four-year) planning, annual planning, and structuring training into phases.
* Pre-recorded material is divided into parts, each focused on a different aspect of planning and programming.
* The goal is to understand how to structure training for performance peaks at the right times.

## Keys to Planning Training Programs
* Start with the end goal—identify the key event or competition.
* Work backwards to set smaller sub-goals and milestones.
* Build a course of action around these sub-goals.
* Adaptability is crucial; plans may need to change due to unforeseen circumstances (e.g., unavailable resources, staff changes).
* Delegation of tasks is important. Assign physical goals to strength and conditioning coaches, technical goals to skills coaches, etc.
* Regularly reflect on and review the program to identify what works and what needs to change.
* Consider long-term athlete development. Avoid overloading athletes early to prevent burnout and encourage lifelong participation in sport.

## Quadrennial (Four-Year) Planning
* Used in Olympic sports and some team sports with major competitions every four years.
* Two main approaches:
    * **Mono-cycle:** Build progressively to a single peak at the end of four years. Common for developing athletes.
    * **Bi-cycle:** Plan for two peaks (e.g., World Cups, Continental Championships) in four years.
* Set performance predictions and goals for each year of the cycle.
* Regularly evaluate progress and update goals as needed.
* Plan for flexibility; injuries and coaching changes may require adjustments.

## Integrated Annual Planning
* Design an annual plan based on the competition calendar and key external factors (e.g., exams, holidays).
* Use planning templates or software to map out key dates, training phases, and performance tests.
* **Macrocycle:** A long term training block, typically one year. 
* **Mesocycle:** A 4–6 week training block.
* **Microcycle:** A one-week training block within a macrocycle.
* Annual plans should include periods for athlete screening, performance testing, and education (e.g., nutrition, recovery, supplement use).
* Assign roles within coaching teams for specific elements (e.g., injury prevention, skills development).

## Periodisation Phases
* **Periodisation** is dividing the training year into distinct blocks to optimize training outcomes.
* Phases of training include:
    * **General Preparatory Phase:** Pre-season block. Emphasizes high volume and moderate intensity. Builds aerobic and endurance capacity. Includes athlete screening, technique work, and varied activities to avoid overtraining.
    * **Specific Preparatory Phase:** Slightly reduced volume, higher intensity. Adds more sport-specific conditioning and skill work. Trial games may be included. Continue monitoring and testing.
    * **Pre-Competition Phase:** Focus on technical, tactical, and mental prep. Training intensity increases, volume decreases. Mimic competition conditions. Deload or taper in the final week before competition.
    * **Competition Phase:** Focus on maintaining capacities. High intensity, low volume. Weekly tapering or deloading as needed. No major technique changes—refine only. Season or key competition period.
    * **Transition/Off-Season Phase:** Vastly reduced volume. Focus on active recovery, rehabilitation, and psychological rest. Maintain some training to minimize detraining. Plan for surgery or personal commitments if needed.

## Considerations for Team vs. Individual Sports
* Team sports require athletes to peak weekly during the competition season.
* Scheduling can be complicated by irregular match days (Friday, Saturday, Sunday).
* Pre-season is used to build capacity and refine basic techniques.
* Individual sports often build toward a single major event every few years.
* More straightforward to predict and program peak performance for individual athletes.

## Mesocycle and Microcycle Planning
* **Mesocycle:** 4–6 weeks in preparatory phases; 2–4 weeks in competition phases.
* Each mesocycle has a main objective (e.g., improve beep test, increase sprint time).
* At the end of each mesoocycle, assess whether goals have been achieved and adjust future plans.
* Progressive overload: Increase training load by no more than 10% per microcycle to reduce injury risk.
* Include planned deload weeks for recovery.

## Microcycle Fundamentals
* A microcycle is a weekly training block.
* Each microcycle has a specific aim: develop, maintain, or unload (taper) a capacity.
* Structure and number of sessions depend on sport, phase, and athlete needs.
* During competition phases, most team sports aim for one main peak per week (usually 3–5 days before the main match).
* Plan for flexibility; schedules may change due to injuries, staff, or recovery needs.

## Example Microcycle (In-Season, Team Sport)
* Sunday: Recovery session (low volume).
* Monday: Higher volume training.
* Tuesday: Hardest session of the week (peak training).
* Wednesday–Friday: Tapering, moderate intensity, technical/tactical focus.
* Saturday: Match day.
* Adjustments may be needed for travel, short turnarounds, or inadequate recovery.

## Example Microcycle (Pre-Season, Team Sport)
* Monday: Two technical training sessions (focus on skills, not heavy conditioning).
* Tuesday: Technical session only (lighter day).
* Wednesday: Conditioning session and trial game for split squad.
* Thursday: Extra conditioning for non-playing squad, scheduled recovery.
* Friday: Technical session and gym-based injury prevention.
* Saturday: Rest.
* Sunday: Lower-intensity technical training.

## Tapering and Peaking
* **Tapering** is a short-term reduction in training load before competition.
* Not the same as detraining; it allows fitness adaptations to emerge while reducing fatigue.
* Classic approach: Reduce both volume and intensity, maintain frequency.
* Modern approach: Reduce volume, maintain or increase intensity. Adjust frequency based on athlete type (maintain for endurance, reduce for speed/power).
* Effective tapering can improve performance by 2–3%.

## Individual Training Session Planning
* Sequence critical capacities first in the week, when athletes are freshest.
* Number of sessions per week depends on phase, recovery, and training goals.
* Limit to one or two high-intensity sessions per week (including match).
* Daily session frequency is typically one; two may occur in preparatory phases or with advanced athletes.
* Session duration depends on focus (longer sessions farther from competition).
* Allow sufficient recovery time between hard sessions (e.g., 2–3 days after heavy strength or power work).
* Not all capacities can be trained together—avoid combining endurance and hypertrophy in the same week or cycle.

## Concurrent Training and Real-World Application
* Speed and power can be trained together, but require careful planning.
* Endurance and hypertrophy should not be combined due to high risk of overtraining and poor adaptation.
* Assess athlete response and recovery throughout the week; adjust session frequency and focus as needed.
* Real-world example (pre-season football): Mix of technical, conditioning, trial games, recovery, and injury prevention across the week.

# Week 6: Session Modification and Games-Based Learning  

## Introduction  
This week focuses on **session modification** and **games-based learning (GBL)**, directly supporting your peer coaching assessment. The aim is to show how we can design coaching sessions that teach skills within a **game context**, rather than in isolation.  

Key themes include:  
* Dynamic Systems Theory and its role in skill development.  
* Using **constraints** (task, performer, environment) to shape behavior.  
* Modification frameworks (TREE and CHANGE IT) for structured adjustments.  
* The Teaching Games for Understanding (TGfU) approach.  
* Designing effective warm-ups.  
* Technique variability, when to modify technique, and how movement differences can be beneficial.  
---
## Dynamic Systems Theory (DST) and Games-Based Learning  
* DST is the **theoretical model underpinning GBL** and motor control.  
* The environment helps coordinate movement patterns. Skills emerge through interaction between:  
  - **Task constraints**: e.g., field size, number of players, equipment used.  
  - **Performer constraints**: e.g., body size, dominance, perceptual/cognitive abilities.  
  - **Environmental constraints**: e.g., weather, surface type, climate.  
### Self-Organization  
* Learners naturally adjust movements to produce stable patterns when constraints are manipulated.  
* Example: A long, narrow pitch encourages **long passing**; a small pitch with close goals encourages **shooting**.  
* **Perception–action coupling** is central:  
  - Perception of the environment informs action (e.g., pass length, movement choices).  
  - Action then influences perception for the next movement.  
* Isolated drills (e.g., passing at cones) lack this coupling; GBL ensures skills are learned under realistic pressure.  
---
## Modification Frameworks  
Two acronyms help structure progressions and regressions:  
### TREE Method  
* **Teaching/Instructional style**  
* **Rules/Regulations**  
* **Environment** (e.g., pitch dimensions)  
* **Equipment** (e.g., ball size)  
### CHANGE IT Method  
* **Coaching style** (instructions, demo).  
* **How to score** (e.g., 2 points for top-corner shot).  
* **Area** (field/court size).  
* **Number of players** (increase pressure, or reduce difficulty).  
* **Game rules** (e.g., limited passes).  
* **Equipment** (scaled implements/balls).  
* **Inclusion** (modify for all players).  
* **Time** (shot clocks, pass restrictions).  
---
## Teaching Games for Understanding (TGfU)  
* Uses **modified games** to teach both skills and tactics.  
* Constraints are changed to reduce technical demands while enhancing learning.  
* Example: **3v3 soccer game** with:  
  - Full-sized goals, small pitch (20 × 10 m).  
  - Rules: Must score within 3 passes; no pass >5 m.  
  - Encourages quick movement, short passing, and shooting under pressure.  
  - Tactical outcomes: defensive pressing, attacking off-the-ball movement.  
### Coaching Cues  
* Must be **skill-focused reminders**, not just encouragement.  
* Example (shooting game): “Are you in open space? Can you take the shot now?”  
---
## Designing Effective Warm-Ups  
* No one-size-fits-all; warm-ups must target the demands of the sport.  
* Warm-up goals:  
  - Raise muscle temperature and heart rate.  
  - Prepare for **decision-making/tactical actions**.  
  - Prepare **technical skills** (e.g., passing, shooting).  
  - Address sport-specific **range of motion** and **strength/power/speed needs**.  
### Evidence from Systematic Reviews  
* **Dynamic warm-ups** (jogging + dynamic exercises) improve sprint, jump, and agility performance (7–8% increases).  
* **Small-sided games** can act as effective warm-ups, particularly for **jumping performance**.  
* **Static stretching** reduces max strength temporarily (up to ~30% decrease), lasting 15–20 minutes. → Best placed at the start of warm-up if included.  
### Warm-Up Formula (Team Sports)  
1. **Range of motion/flexibility** (early, low-load static or dynamic stretches).  
2. **Dynamic component** (3–5 minutes: progressive run-throughs, mobility drills).  
3. **Skills warm-up** (closed to open progressions, gradually adding complexity).  
4. **Small-sided game** (integrates physical, technical, and tactical demands).  
* Duration: ~20–30 minutes.  
* Variations for different sports (e.g., **throwing sports**: emphasize progressive ROM and force at extreme joint angles, external rotator activation, progressive throws).  
---
## Technique and Movement Variability  
* Traditional coaching emphasizes **ideal technique** based on elite exemplars.  
* Evidence shows:  
  - **Elite performers succeed with “unorthodox” technique** (e.g., Don Bradman’s batting grip; Donald Thomas’s high jump).  
  - Motor performance always shows **variability** (e.g., running stride angles differ step-to-step).  
* Conclusion: **No single “perfect” technique exists**. Coaches should allow exploration within constraints.  
### When to Modify Technique  
Only in two cases:  
1. **Injury prevention**  
   * Example: A college runner with recurrent hamstring injuries adjusted running technique after shoulder reconstruction altered pelvic rotation. Correcting arm swing reduced hamstring strain.  
2. **Performance enhancement**  
   * Example: Figure skaters modified spinning technique (arms/legs close to body) to increase aerial rotation speed.  
---
## Key Takeaways  
* Use **constraints-led coaching** and games-based learning to develop skills under realistic game conditions.  
* Apply **TREE/CHANGE IT** to design activities with planned progressions/regressions.  
* Warm-ups must be progressive, sport-specific, and avoid isolated static stretching close to performance.  
* Accept **variability in movement** as normal; modify technique only for injury prevention or performance improvement. 


# Week 7: Long-Term Athlete Development (LTAD) and Periodisation

## Introduction
This week examines the **Long-Term Athlete Development (LTAD) framework** and introduces **periodisation** in training planning. Both concepts are essential for designing effective programs that support athletes across their lifespan and optimise performance for different goals.

---

## Long-Term Athlete Development (LTAD)
LTAD describes a staged approach to athlete growth and skill development, considering **biological, psychological, and social changes** across life stages.

### Key Stages of LTAD
1. **Active Start (0–6 years)**  
   * Focus: Fundamental movement skills (running, jumping, throwing).  
   * Play-based, fun, exploratory movement.  

2. **FUNdamentals (6–9 years, girls; 6–10 years, boys)**  
   * Build fundamental movement patterns and basic sports skills.  
   * Speed, agility, balance, coordination emphasised.  
   * Avoid early specialisation.  

3. **Learn to Train (8–11 years, girls; 9–12 years, boys)**  
   * Sport-specific skill development begins.  
   * Multiple sports participation is encouraged.  
   * Importance of skill variety and basic tactics.  

4. **Train to Train (11–15 years, girls; 12–16 years, boys)**  
   * Emphasis on aerobic fitness, strength basics, and sport-specific skills.  
   * Periodisation begins: structured seasonal planning.  
   * Peak Height Velocity (PHV) is a critical consideration.  

5. **Train to Compete (15–21 years, depending on maturity)**  
   * Sport-specific focus; high-intensity training.  
   * Tactical and technical refinement.  
   * Specialisation becomes more pronounced.  

6. **Train to Win (18+ years, elite level)**  
   * Maximise performance at international/professional levels.  
   * Highly individualised periodisation.  
   * Full-time training and competition.  

7. **Active for Life (any age)**  
   * Transition from competitive sport to lifelong activity.  
   * Participation, health, and enjoyment prioritised.  

---

## Periodisation
Periodisation is the **systematic planning of training** to maximise performance at specific times, while managing fatigue and recovery.

### Levels of Periodisation
* **Macrocycle**: Long-term (often a year or more).  
* **Mesocycle**: Medium-term (weeks to months), focuses on phases (e.g., preparation, competition).  
* **Microcycle**: Short-term (usually 1 week), details day-to-day training.  

### Periodisation Phases
1. **Preparatory Phase**  
   * General preparation: endurance, strength, basic skills.  
   * High training volume, lower intensity.  
2. **Pre-Competition Phase**  
   * Increased intensity, sport-specific drills.  
   * Reduced training volume.  
   * Tactical preparation.  
3. **Competition Phase**  
   * Maintain fitness while maximising readiness.  
   * Focus on competition performance.  
   * Tapering before key events.  
4. **Transition Phase**  
   * Rest and recovery (active rest).  
   * Mental and physical regeneration.  

### Tapering
* Reduction in training load before competition.  
* Allows recovery and peak performance.  
* Often 1–3 weeks depending on sport.  

---

## Integration of LTAD and Periodisation
* LTAD provides the **big picture** of athlete development across years.  
* Periodisation provides the **short-term structure** to achieve peak performance.  
* Example:  
  - **Train to Train phase**: Use mesocycles to balance growth, skill development, and recovery during PHV.  
  - **Train to Win phase**: Sophisticated macrocycles tailored to major competitions.  

---

## Practical Coaching Implications
* Match training content to athlete’s developmental stage.  
* Avoid early specialisation to reduce burnout and injury risk.  
* Use periodisation to:  
  - Prevent overtraining.  
  - Peak for competitions.  
  - Balance skill, physical, and tactical development.  
* Encourage transition into Active for Life for long-term participation.  

---

## Key Takeaways
* LTAD outlines stages from early childhood through elite sport to lifelong activity.  
* Periodisation structures training into macro, meso, and micro cycles.  
* Tapering and planned recovery are crucial for peak performance.  
* Effective coaching requires blending LTAD principles with periodisation to meet athlete needs.  

# Week 8 Training File

## LTAD Stages

**Learn to Train (LTT)**  
- Girls 8–11, Boys 9–12  
- Formalise training: tactics, skills, conditioning  
- Variety: ≥1 team sport, ~3 days sport-specific, ~3 days other sports  
- Training:Competition ≈ 70:30  
- Emphasis: sport-specific skills, coordination/fine motor window  
- Manage early/late maturers; arms/legs grow before trunk; possible ↓flexibility  
- Aerobic via games; anaerobic/speed via relays; strength via bodyweight, plyometrics, trunk control  

**Train to Train (TTT)**  
- Girls 11–15, Boys 12–16  
- Puberty changes (physical, psycho-social)  
- “Build the engine”: aerobic base, speed, strength, flexibility  
- Refine to 2 sports across seasons; toward position-specific tactics  
- Training:Competition ≈ 60:40 (meaningful comp)  
- PHV ~11y girls, ~14y boys; ↑RBC esp. boys; heart/lung growth  
- Individualise loads; monitor growth; deload every 4–5 wks  
- Cognitive: abstract thinking established → drill/strategy complexity to skill; positive reinforcement; reflection; recognition of visual cues  

## Coaching & Parents

- Limit explicit feedback → guided discovery; mistakes as learning  
- Rotate positions/events for broad understanding  
- Girls CNS matures earlier → may manage complex drills sooner  
- Parents: avoid early specialisation; balance sport/school; focus on development not winning  

## Overuse & Growth Conditions

- **Osgood-Schlatter (knee):** tibial tuberosity traction, quad eccentrics; manage load; gradual progress; deloads; symptom checks  
- **Sever’s (heel):** Achilles traction at calcaneus; girls ~8–10, boys ~10–12; sprint/jump eccentrics; gradual load; deloads  
- **Lateral epicondylitis:** racket sports; wrist extensor eccentrics; monitor pain, loads  
- **Medial epicondylitis (little leaguer’s elbow):** throwing; wrist flexor eccentrics near medial epicondyle; load management, palpation checks  
- **Scheuermann/Shulman’s:** vertebral wedging, thoracic kyphosis; not caused by exercise but worsened by posture/static positions  

## Thermoregulation

- Children gain heat faster; ↓sweating; slower acclimatisation → ↑heat-illness risk  
- Management: drink breaks every 15–20 min, symptom checks (headache, lethargy), shade/activity modification  

## Equipment & Technique

- Size/weight mismatches ↑joint torques, injury risk  
- Leg extension: seat/knee crease align to pivot → avoid dislocation stress  
- Shoes: correct sizing; arch support alignment; oversized shoes → foot/knee/hip issues  

## Retrieval Tags

LTAD, Learn to Train, Train to Train, LTT, TTT, PHV, early maturers, late maturers, coordination window, abstract thinking, guided discovery, explicit feedback, meaningful competition, position rotation, aerobic via games, relays, plyometrics, trunk control, deload week, RBC, menarche, iron, Osgood-Schlatter, Sever’s, lateral epicondylitis, medial epicondylitis, little leaguer’s elbow, Scheuermann, Shulman, thermoregulation, heat illness, drink break 15–20 min, equipment modification, leg extension alignment, shoe fit.

# Week 9 Training File

## LTAD Stages (Later Stages)

### Training to Compete (TTC)
- Ages: Males 16–23, Females 15–21  
- Must complete Train to Train objectives first (PHV, growth, physical capacities developed)  
- Focus: optimize strength, power, technical/tactical, periodisation, recovery  
- Programmed recovery & deload weeks essential  
- Optimize ancillary capacities (less central but still relevant)  
- Individualisation critical: target weak areas, support strengths  
- Specialisation: 1–2 sports; high training volume/intensity; near year-round training  
- Two phases:  
  - Initial specialization (to ~19–20y): performance ↑ still partly from growth/maturation  
  - Final specialization (early 20s): performance gains from training adaptations  
- Open-ended stage: may continue recreationally instead of progressing to Training to Win  
- Support: sophisticated programs, career planning, increased staff (nutrition, psych, etc.)  
- Physical: cardiovascular/respiratory mature → endurance capacity targeted; growth plates fused (↓growth-related injury risk); strength peaks late 20s–30s  
- Cognitive: near-adult brain size; can handle tactics/strategies under pressure; critical thinking, problem solving, deductive reasoning, self-analysis  

**Coaching Implications (TTC):**
- Year-round, high-intensity, event/position-specific training  
- Teach skills under varied competition conditions (weather, environment)  
- Model competition in training  
- Continuous monitoring: wellness, HR, strength/power variables  
- Training:Competition ≈ 40:60  
- Introduce “24-hour athlete” concept: sleep, nutrition, stress management  
- Tapering essential (reduce volume, maintain intensity); mimic competition conditions  

---

### Training to Win (TTW)
- Ages: Males 19+, Females 18+ (fluid transition from TTC)  
- Athletes: elite, full-time professionals  
- Objective: **High performance + Winning competitions**  
- Capacities fully developed (physical, cognitive, mental)  
- Training:Competition ≈ 25:75  
- Annual training volume: ~800–1400 hrs (peak mid-20s, decline after)  
- Stages:  
  - Mastery → reach world-class level  
  - Stabilization → maintain peak, minor improvements  

**Objectives (TTW):**
- Prepare athlete for competition (major focus = winning)  
- Holistic support: coach, S&C, physio, psych, nutritionist  
- Autonomous athlete: independent prep, decision-making  
- Maximise & periodise recovery strategies  

**Physical Implications (TTW):**
- Fully mature systems → rigorous training of all systems possible  
- Advanced monitoring critical (training load, GPS, HR, Excel/Team Builder)  

**Cognitive Implications (TTW):**
- Neurological maturity → self-analysis, joint coach-athlete decisions  
- Collegial coach-athlete relationship  
- Decision-making under pressure; better rule/regulation comprehension  
- Avoid poor choices (e.g., doping)  

**Coaching Implications (TTW):**
- Winning becomes central goal  
- Athlete empowerment in decisions (training load, recovery, scheduling)  
- Must train performance under pressure & suboptimal environments  
- Mental preparation essential → psych support for stress & on-demand performance  
- Training load monitoring & tapering key; 2–3 major peaks/year  
- “2% rule”: athletes within 2% of PB before comp → peak performance likely  
- Taper ≠ detraining: ↓volume, maintain intensity  

---

### Active for Life (AFL)
- Transition from high-level to recreational/participation  
- Inclusive: competitive → recreational → purely health/activity focus  
- Streams:  
  1. **Competitive for Life:** e.g., Masters sports; inclusion, enjoyment, flexible competition; modifiable training; recovery/rehab key  
  2. **Fit for Life:** ≥60 min moderate or 30 min vigorous activity most days; inclusion, social, health maintenance; use skills from prior sports to remain active; modifications common (injuries, health conditions)  
  3. **Sport & Physical Activity Leaders:** transition into coaching, officiating, admin; use prior experience to foster positive environments  

**Importance (AFL):**
- Addresses obesity epidemic, low adult activity rates  
- Stats: 70% Australian men, 50% women, 25% children overweight/obese  
- Benefits:  
  - Physical: ↓risk of CVD, diabetes, cancer; ↓BP/cholesterol; ↑strength, endurance, BMD; ↓falls & fractures; maintain healthy weight  
  - Mental: better sleep, ↓stress/depression, ↑memory/concentration, ↑self-esteem & wellbeing, social connections  

**Objectives (AFL):**
- Retain lifelong participation  
- Motivate inactive adults → more frequent activity  
- Transition competitive athletes into new roles (coaching, admin, officiating)  
- Recruit/develop leaders to encourage participation  

---

## Retrieval Tags

TTC, TTW, AFL, Train to Compete, Train to Win, Active for Life, specialization, initial specialization, final specialization, mastery, stabilization, periodisation, tapering, recovery, 24-hour athlete, ancillary capacities, individualized training, holistic support team, training load monitoring, GPS, HR, Team Builder, Excel, 2% rule, PB readiness, multiple peaks, competitive for life, fit for life, sport leaders, obesity epidemic, Australian stats, chronic disease prevention, bone density, falls, mental health, wellbeing, social benefits



# Week 10 Training File - Coaching Female Athletes: Sex, Physiology, Menstrual Cycle & Coaching Considerations

---

## Sex, Gender & Classification in Sport (IOC Context)
* **Sex vs Gender:**
  * **Sex (biological):** Determined by sex chromosomes. Typically, biological males = XY; biological females = XX. Distinct characteristics follow: males typically have external genitalia; females have internal genitalia including a uterus. Differences extend to sex organs, hormones, and reproductive anatomy.
  * **Gender:** More complex; perceived/internal sense of one’s biological sex. Gender identity may not align with biological sex; some individuals transition. This creates major considerations for participation and classification in sport.
* **Chromosomal Variations / DSDs:**
  * XX/XY distinction is **not always** straightforward. There are numerous sex developmental disorders and variations (e.g., single sex chromosome; part of a Y chromosome translocated onto an X chromosome). These combinations can produce different physical expressions of biological sex, with serious implications for fairness in sport.
* **Historical & Evolving Verification Approaches:**
  * **1940s–1960s:** Invasive, disrespectful physical examinations to assess genitalia.
  * **Later:** Shift to chromosomal testing (male = XY, female = XX). **Problem:** does not account for wide chromosomal variation and DSDs.
  * **Contemporary focus:** Testosterone levels and athlete gender self‑identification.
* **Illustrative Case – Caster Semenya:**
  * Middle‑distance runner classified as biological female with a DSD producing male phenotypical characteristics and **elevated testosterone**, conferring a significant advantage. Case spans many years and shows why simple chromosomal tests can be inadequate for fair classification.
* **Why Testosterone Matters in Classification:**
  * Testosterone fosters development of strength, power, muscle mass, and even aerobic capacity.
  * Elevated testosterone can give an unfair biological advantage if competing as female.
  * Advantage often **persists** even after transition from male to female because benefits from puberty‑level testosterone exposure appear long‑lasting.
* **Typical Testosterone Ranges (context for policy):**
  * **Males:** ~10–35 nmol/L (average in low 20s).
  * **Females:** ~0.35–2.0 nmol/L (average ~1.5 nmol/L).
  * **Past practice:** Female athletes with >10 nmol/L were required to undergo surgery or chemical reduction. Side effects were harsh → guidelines revised to avoid unnecessary harm.
* **Evidence Snapshot (Systematic Review cited in transcript):**
  * Review examined hormonal/physical changes in transgender women (male‑to‑female).
  * After **12 months** of transition: ~**4% reduction in lean body mass** (likely smaller than average male–female difference).
  * **Strength reductions** were **not substantial**.
  * Testosterone levels often **remained above** competitive cutoff.
* **IOC Policy Timeline (from transcript):**
  * **2015:** Transgender female athlete’s testosterone must remain **< 10 nmol/L** for **≥12 months** before first competition.
  * **2021:** IOC releases a new framework acknowledging difficulty of universal rules; responsibility shifts to **individual sporting organizations** to set sport‑specific participation/classification rules.

---

## Physiological & Skeletal Differences Relevant to Coaching
* **Physiological Differences (from transcript):**
  * Testosterone levels, blood supply to muscles, heat dissipation, lean body mass, and aerobic capacity differ between males and females.
* **Five Skeletal Differences with Coaching Implications:**
  1. **Pelvis Shape:** Female pelvis is wider (adaptation for childbirth). With a typically narrower trunk, this can create a **mechanical advantage** for force transfer (throwing/hitting: golf, tennis, softball). **Potential downside:** wider pelvis can increase inward femoral slope → higher risk of **knee/hip problems** including **ACL injuries**.
  2. **Center of Gravity:** Lower in females (shorter stature + wider hips). **Advantages:** stability/balance; faster rotations and greater aerial maneuverability (e.g., gymnastics, dance).
  3. **Femoral Varus:** Inward angle of femur relative to vertical is often **steeper** in females.
  4. **Q‑Angle:** Angle between quadriceps and patellar tendon is often **larger** in females → landing with **knee valgus** (knees collapse inward) stressing knee/hip structures, particularly the **ACL**.
  5. **Carrying Angle (Elbow):** Forearm angles away from body **more** in females → increased **shear** and **rotational torque** during weight‑bearing (handstands) or throwing → may elevate **elbow injury** risk.
* **ACL Injury Risk Factors Noted in Transcript:**
  * Female athletes are **2–8×** more likely to sustain **non‑contact ACL injuries** than males.
  * Contributing factors: hormonal changes during menstrual cycle increasing **ligament laxity** (looseness); **quadriceps dominance** relative to hamstrings (hamstrings help protect ACL).

---

## Coaching Interventions from the Transcripts
* **Movement & Technique:**
  * Teach **landing** with greater hip/knee flexion (lower, more athletic stance) to reduce knee‑ligament strain.
  * Coach **proper foot placement** during running.
  * Optimize **throwing/hitting techniques** to leverage mechanics while mitigating risk.
* **Strength & Conditioning:**
  * Prioritize **posterior chain** development—especially **hamstrings** and **glutes**—to stabilize the knee and reduce ACL‑injury risk.
  * Develop a **wide range of fundamental movement skills** (running, jumping, landing, changing direction) from an early age to build safe, durable patterns.

---

## Menstrual Cycle Physiology (Phases, Hormones, Effects)
* **Cycle Length & Phases (from transcript):**
  * Typical cycle ≈ **28 days** (natural inter‑individual variation).
  * **Menstrual phase:** **Days 1–5** (shedding uterine lining if no pregnancy).
  * **Follicular phase:** **Days 1–13** (overlaps with menstrual phase).
  * **Ovulation:** around **Day 14** (egg release).
  * **Luteal phase:** **Days 15–28**.
* **Key Hormones:**
  * **Estrogen:** Peaks late follicular; **thickens uterine lining** for pregnancy. **Body‑wide effects:** helps maintain **bone density** by limiting bone breakdown (osteoporosis prevention), has **cardiovascular protective** effects, and can **influence mood** via neurotransmitters.
  * **Progesterone:** Peaks mid‑to‑late luteal; **maintains** uterine lining. **Body‑wide effects noted:** raises **core body temp by ~0.3–0.5°C** (noticeable for training), has **calming/sedative** mood effects, increases **water retention** → feelings of **bloating**.

---

## Menstrual Cycle & Performance: Evidence + Exceptions
* **Overall Evidence (from transcript):**
  * On average, **cycle phase has no significant effect** on key performance variables like **VO₂**, **time‑to‑exhaustion**, or **power output**.
  * **Important caveat:** symptoms and cycle duration vary widely—individualize for affected athletes.
* **Exceptions / Considerations:**
  * **Heat 🥵 (mid‑luteal):** Elevated core temp can increase cardiovascular strain and **reduce endurance** in **hot conditions**.
  * **Injury Risk 🤕 (luteal):** **Relaxin** increases **ligament laxity**, reducing joint stability (knees/ankles) → greater susceptibility to **ACL** and **ankle sprains**.
* **Training Modifications Suggested in Transcript:**
  * Consider **reducing volume/intensity** during **early follicular** and **late luteal** phases.
  * **Late luteal:** modify **high‑impact** activities (e.g., jump landings) and **excessive flexibility** work to protect joints.
  * Be wary of **intense aerobic work in heat** during **luteal** phase.
  * Keep **skill sessions simple** during periods of **psychological stress**.

---

## Monitoring Tools
* **Cycle Tracking:** Lab testing is often impractical. Use **free smartphone apps** (e.g., **Clue**) for **non‑invasive** tracking and **cycle‑phase prediction** to anticipate changes and adapt training.

---

## Menstrual Disorders (from transcript definitions)
* **Eumenorrhea:** Regular cycle (**23–35 days**).
* **Oligomenorrhea:** Irregular cycle (**35–90 day intervals**).
* **Amenorrhea:** Absence of period for **3–6 consecutive months**.

### Amenorrhea: Prevalence, Links & Consequences
* Affects about **20% of female athletes**.
* Strongly linked to **high training volumes** and **low body weight**.
* **Consequences of prolonged disruption:**
  * **Fertility problems**.
  * Increased risk of **cardiovascular disease**.
  * **Premature osteoporosis** (brittle bones) due to reduced estrogen.
  * **Lower bone mineral density**; if amenorrhea lasts **>3 years**, bone loss may be **irreversible**.

---

## Female Athlete Triad (from transcript)
* Describes the relationship between:
  1) **Energy availability**, 2) **Menstrual function**, and 3) **Bone mineral density**.
* **Pathway described:** **Low energy availability** (energy expenditure not matched by intake—e.g., high training volume + insufficient nutrition) → **menstrual dysfunction** → **poor bone health**.
* **Coaching implication:** Ensure **adequate nutritional intake** to support training loads and prevent negative health outcomes.

---

## Quick Reference: Coaching Checklist Synthesized from Both Transcripts
* **Classify & include fairly:** Understand IOC 2015 cutoff (<10 nmol/L for ≥12 months) and 2021 shift to sport‑specific rules; recognize DSDs and complexities (e.g., Semenya case).
* **Screen mechanics:** Watch for knee valgus (Q‑angle, femoral varus), elbow strain (carrying angle), and coach safer landings/foot placement.
* **Build posterior chain:** Prioritize hamstrings and glutes; develop fundamental movement skills early.
* **Periodize by cycle:** Consider lower volume/intensity in early follicular and late luteal; limit high‑impact/flexibility late luteal; avoid intense aerobic work in heat during luteal; simplify skills under stress.
* **Track cycles:** Encourage non‑invasive app tracking (e.g., Clue) to anticipate adaptations.
* **Protect bone health:** Monitor for eumenorrhea/oligomenorrhea/amenorrhea; act on amenorrhea risk factors and consequences; ensure sufficient energy availability to prevent the Female Athlete Triad.


# Week 11 Training File - Coaching Diverse Populations: Ageing, Disability, and Para‑Athletes

---

## Video 1 – Core Themes
* **Purpose**: Understand physiological changes in ageing, required screening/monitoring, and coaching modifications to safely and effectively program training.
* **Anchor principle**: Thorough **pre‑exercise screening** and **close monitoring** are critical with older athletes due to age‑related physiological changes.

---

## Pre‑Exercise Screening & Monitoring (Ageing Populations)
* **Initial medical screening** (mandatory for all; increasingly important with age).
  * In Australia, use **ESSA pre‑exercise screening** to identify common health conditions and classify **low / moderate / high risk** for adverse exercise events.
  * **Moderate or high risk → medical clearance required** from doctor **before** training commences.
* **Physical examination** typically follows to assess **cardiovascular, respiratory, and musculoskeletal** systems.
  * Rationale: risk of **exercise‑induced myocardial ischemia (heart attack) increases with age**.
* **Medication review**: Be aware of medications and their potential effects on exercise responses.
* **Lifestyle factors** (e.g., diet) must be considered.
  * Some dietary habits influence **osteoporosis** (low bone density) risk → requires program modifications.
* **Early‑phase monitoring (first few months)**:
  * Track **soreness** (should dissipate over time).
  * Confirm **training intensity** is appropriate and enables **adequate recovery**.

---

## Age‑Related Physiological Changes (What Declines?)
* **Global trend**: Multiple capacities **deteriorate with age**—strength, power, endurance—**but at different rates**. Check the graph in the slides for this week for more details. 
* **Most affected examples**:
  * **Reaction time**: Significantly reduced—as when tripping while walking; slower ability to adjust gait due to other system deficits.
  * **Vital capacity** (green line in the described figure): Max air inhaled after full exhalation **decreases** → limits oxygen intake/delivery to working muscles → impacts performance.
* **Other notable declines**:
  * **Cardiac output** → reduced endurance.
  * **Basal metabolic rate** ↓ → predisposes to **increased body fat**.
  * **Nerve conduction velocity** ↓ → signals travel more slowly to muscles (affects **strength, power, reaction time**).
  * **Brain weight** ↓ → may reduce **cognitive performance** and **attention**.

---

## Bone Health & Osteoporosis
* **Bone remodeling**: Bones constantly undergo breakdown and reformation to adapt to stress.
  * With age, **destruction > replacement** → net **bone mass loss** → **weaker, more brittle bones**.
* **Accelerating factors**: **Poor calcium intake**, **hormonal changes**, **deficient calcium absorption**, **low physical activity**.
* **Osteoporosis** (“porous bones”):
  * **Trabecular (spongy) bone** becomes **far less dense** → compromised structural integrity → **higher fracture risk** from impacts.
  * Loss occurs in men and women but **faster in females after menopause** (hormonal shifts).
* **Common fracture‑risk sites**: **Spine, wrist, hip, pelvis, upper arm**.
  * **Kyphosis** (pronounced upper‑spine curvature): vertebrae lose density → can’t support superior structures → compression and postural change.
* **Coaching implications**: Identify at‑risk athletes; **modify activities** and implement **specific exercises** to improve bone density over time.

---

## Exercise for Bone Density: What Works (and What Doesn’t)
* **Effective stimulus**: **High‑impact** and **resistance** exercises increase mechanical stress on bone.
  * **Forceful muscle contractions** (e.g., lifting) and **landing impacts** (e.g., jump‑landings) signal the body to **lay down new bone** → **stronger, denser** bones.
* **Less effective / potentially negative for bone density**:
  * **Low‑impact** modalities popular among older adults—**swimming**, **cycling**—are **excellent for cardiovascular health** but **do not** provide sufficient bone‑loading stimulus.
  * Some studies show **reductions in bone density** in certain regions with these modalities.
* **High‑impact examples with positive effects**: **Volleyball**, **weight lifting**, **gymnastics** → increases in bone density in **spine, hips, limbs**.
* **Applying principles safely in older adults**:
  * Many elderly cannot perform complex gymnastics; **regress movements** to match ability.
  * **Key takeaway**: Activities with **impacts** and **forceful contractions** drive bone growth—use **exercise regression** (e.g., modified **jump‑landings**) to keep training **safe** while **osteogenic**.

---

## Connective Tissue Changes (Tendons, Ligaments, Capsules)
* **With age**: **Stiffer, less elastic** connective tissues.
  * **Water content decreases**; **collagen fibers** become **thicker** and more **cross‑linked**.
  * **Elastin fibers** become **less elastic**.
* **Mitigation**: Decline can be **slowed** with **gentle movement** and **range‑of‑motion** exercises.
* **Functional impact**: Contributes to **reduced mobility** and **flexibility**.

---

## Sarcopenia & Muscle Function
* **Sarcopenia**: Significant **loss of muscle tissue** with age.
  * After **~45 years**, loss ≈ **3 kg of muscle mass per decade**.
  * **Type II (fast‑twitch)** fibers atrophy **faster** than **Type I (endurance)** fibers → **speed** and **power** decline more than endurance.
* **Coaching importance**: **Power maintenance** helps with rapid postural adjustments to **prevent falls** (major risk in older adults).

---

## Resting Metabolic Rate (RMR), Energy Balance & Body Composition
* **RMR** decreases by **~2% per decade**, largely due to loss of metabolically active muscle.
* An average **70‑year‑old needs ~500 fewer kcal/day** than a **20‑year‑old**.
  * **Common issue**: Dietary intake **not reduced accordingly** → **energy surplus** + **lower activity** → **increased body fat**.
* **Programming recommendation**: Combine **weight training** and **aerobic exercise** to **maintain muscle mass** and a healthier **RMR**.

---

## Aerobic Capacity (VO₂ max / VO_2 max) & Cardiovascular Considerations
* **VO₂ max** decreases by **~30–40%** from **age 25 to 80**.
  * Contributors: **Lower physical activity**, **reduced maximal heart rate**, **less muscle mass** available to utilize oxygen.
* **Limiting the decline**:
  * Include **high‑intensity endurance** work **if deemed safe after screening**, alongside **muscle‑building** activities.
* **Heart‑rate prescription adjustments**:
  * **Max HR declines with age** (approx. **220 − age**).
  * Therefore **absolute HR targets differ** in older athletes; may need **lower HR targets** or use **RPE** as an alternative.

---

## Nervous System & Cognitive Function
* **Neuromuscular changes**:
  * **Reduced connections** between nerves and muscles.
  * **Slower conduction velocity** → impaired **rapid force production**.
* **Sensory‑processing**: **Slower processing** → **longer reaction times**, **reduced balance**.
* **Positive note**: Symptoms of some age‑related cognitive conditions can be **reduced through activity**.
  * Include **mental games** and **skills‑based learning**.
  * The **brain remains capable of learning**; target **neurological systems** in training to **limit ageing effects**.

---

## Coach’s Quick Checklist (Ageing)
* ✅ **Screening**: ESSA tool → **risk classification**; obtain **medical clearance** for **moderate/high** risk.
* ✅ **Examination**: Check **cardiovascular/respiratory/musculoskeletal** systems; note **age‑related MI risk**.
* ✅ **Medications & Lifestyle**: Review meds; consider diet and osteoporosis risk.
* ✅ **Early Monitoring**: Track soreness trend; ensure intensity allows recovery.
* ✅ **Bone Health**: Prioritize **impact** + **resistance** (regressed where needed); limit reliance on **swim/cycle** for bone outcomes.
* ✅ **Sarcopenia**: Emphasize **power**, **hamstrings/glutes**, and **strength** to reduce falls risk.
* ✅ **RMR & Energy**: Address caloric needs; pair **aerobic** + **resistance** training.
* ✅ **Endurance**: Incorporate **HI endurance** if safe; adjust **HR targets** or use **RPE**.
* ✅ **Mobility/ROM**: Gentle movement and ROM work to slow connective‑tissue stiffness.
* ✅ **Neuro/Cog**: Add balance, reaction, and skills‑based cognitive tasks.

---


## Video 2 – Older Athletes (continued) & Athletes with a Disability

### Managing Older Athletes: Expectations, Load, & Progression
* Athletes with a competitive history may **overestimate current ability**, especially after a break.
* Strictly apply **progressive overload**; avoid large jumps in load that younger athletes might tolerate.
* Use the **initial briefing** to set expectations, explain **age‑related declines**, and outline a **sensible progression plan**.
* Older athletes can be **impatient** with perceived slow progress because adaptation is slower while tissues are regressing. **Educate early**.
* Build a **supportive environment** (e.g., pair with other older athletes as mentors) to set **realistic expectations**.

### Specific Physical Declines & Program Elements
* **Muscle weakness**, particularly in the **lower limbs**, requires **targeted gym work** to support sport‑specific movements.
* **Joint problems & immobility** (often from past injuries → e.g., **osteoarthritis**): **refer** to appropriate health professional; **modify technique** to accommodate permanent **ROM reductions**.
* Always incorporate **mobility training** in programs for older athletes.

### Screening, Medications, Body Composition & Injury Prevention
* Given increased **cardiac risk** with age, **pre‑exercise medical screening is non‑negotiable**.
* Be aware of **common medications** such as **statins** and **beta‑blockers**; they can significantly affect exercise responses.
* **Educate** about **body‑composition changes**: progress may be **slower** due to **increased body fat**; manage via **diet + exercise**.
* **Injury risk increases** with age → thorough **warm‑up** and **targeted injury‑prevention** exercises are **essential**, not optional.

### Masters Athletes
* Typically **>35 years** (varies by sport; some categories extend to **60+ / 70+**).
* Often maintain a **highly competitive mindset** and will push to limits as if younger → **higher risk** of adverse events (**cardiac arrests**, **osteoarthritis flare‑ups**, **impact‑related fractures**).
* Program **more recovery**: consider an **extra recovery day**; limit **high‑intensity** sessions to **once/week** instead of two.
* **Constant monitoring** of training response is vital to track recovery and ensure **positive adaptation** over time.

### Coaching Athletes with a Disability: Principles & Context
* **Classification systems** aim to create **fair/equitable competition** by grouping similar impairment levels, but this is **challenging**—especially with wide symptom variation; sometimes **insufficient high‑level competitors** exist to form a competition.
* **Scientific knowledge** is **limited**; much comes from **rehabilitation/clinical** settings and may not transfer directly to **elite sport**.
* Athletes with disabilities often show **lower baseline fitness** due to systemic issues: **physiological restrictions**, **fewer participation opportunities**, **limited facility/equipment access** (funding), and **less exposure to high‑quality coaching**.

### Training Approach & Inclusion
* **Do not treat** athletes with a disability **differently** in fundamentals: training, programming, and load monitoring are the **same**; **modify** only for specific physical differences or **adjust recovery**.
* Example: The **high‑performance swimming program at the University of the Sunshine Coast** integrates **Olympic and Paralympic** athletes; training principles are **remarkably similar**.
* **Grassroots inclusion** into able‑bodied sport where possible. Use the **TREE model** (**Teaching**, **Rules**, **Equipment**, **Environment**) to guide modifications.

### Program Development Process (unchanged fundamentals)
* **Needs analysis** → set **realistic goals** based on strengths/weaknesses → **develop & monitor** program → **reassess** and set new goals.

### Fatigue & Environmental Considerations
* **Faster onset of fatigue** is common (often due to lower baseline fitness). **Adjust duration** and **increase rest** as needed.
* **Hot, humid climates** (e.g., Australia): ensure **longer rest** and **hydration breaks**—especially for **spinal cord injury (SCI)** where **thermoregulation is impaired**.

### Classification Measures (what informs classes)
* Combination of **muscle strength**, **range of motion**, **proprioception**, and **sport‑specific metrics**.
* In **SCI**, even small differences in **lesion location** can have **massive effects** on physical function.

### Common Disability Types (local Paralympic programs)
* **Amputees**
* **Cerebral Palsy**
* **Spina Bifida**
* **Spinal Cord Injury**
* **Vision Impairment**

### Amputees — Coaching Considerations
* **Definition**: At least one **major limb or joint missing**; origin may be **congenital** or **traumatic**. Most compete using a **prosthesis**; remaining muscles usually have **normal strength** and **proprioception**.
* **Classifications** depend on the specific body part amputated (e.g., **A1** = **double leg above‑knee amputation**).
* **Key issues**:
  * **Skin care** around the **residuum**: irritation inside the prosthesis can lead to **cuts/infection** in **hot, humid** environments → schedule **periodic ventilation**; allow **rest periods** to remove prosthesis.
  * **Centre of gravity** shifts → balance changes; **side‑to‑side discrepancies** may provoke **pelvic/low back pain**.
  * **Thermoregulation**: large **body surface area loss** can impair cooling → manage **hydration** and **session duration** in the **heat**.

### Spinal Cord Injury (SCI) — Definitions & Classes
* **Lesion** on the spinal cord causing **partial/complete** loss of **motor and sensory** function **below** the injury.
* Injured region may be **cervical (neck)**, **thoracic (torso)**, or **lumbar/sacral (pelvic)**.
* **Paraplegia**: loss of function in **trunk + lower limbs** (damage typically at **T2 or below**).
* **Quadriplegia**: loss of function in **trunk + both lower and upper limbs** (damage **higher** in the **cervical** spine).
* **Complete vs incomplete** lesions: **no signals** vs **some signals** pass the injury site → degree of **residual function**.

### SCI — Coaching Implications
* **Learning**: Loss of **touch/proprioception** can **slow new skill acquisition**.
* **Temperature regulation**: **Sweating impaired** below the lesion → **overheating risk** → implement **heat acclimatization**, **frequent hydration**, and **pre‑cooling** (e.g., **ice packs**, **slushies**).
* **Autonomic dysreflexia**: Dangerous **BP spikes** from a **painful stimulus** below the lesion (often unfelt). Some athletes have attempted to **induce ("boost")** this state to lower perceived exertion. The **IPC** once branded this as **doping**, but it was **withdrawn** because it’s hard to assess. To safeguard health, **monitor blood pressure** **before/after** competition and training.
* **Wheelchair athletes**: High risk of **pressure sores** (hips/buttocks) and **shoulder overuse injuries** from propulsion mechanics → requires **careful training management**.



## Video 3 – Additional Disability Classifications & Coaching Implications

*Context*: Third and final part of coaching diverse populations; covers remaining disability classifications and coaching implications.

### Cerebral Palsy (CP)
* **Definition**: Motor disorder affecting **movement and posture**.
* **Onset/Etiology**: Typically develops **very young**; **~80%** acquired **before birth** (e.g., **stroke** or **brain injury** during pregnancy).
* **Severity/Participation**: Motor deficits (gait, balance, posture) can be severe; **~half of athletes with CP** participate **in a wheelchair**.
* **Most common type**: **Spastic cerebral palsy**.
  * **Spasticity** = **increased muscle tone** from an **over‑excited reflex**.
  * **Normal stretch reflex**: rapid muscle stretch → reflex contraction (helps generate force, e.g., **sprinting**).
  * **In CP**: reflex is **hyperactive** → **continuous stretch** can trigger **involuntary, rigid contraction (contracture)** that can **onset randomly during exercise** → **marked gait changes**.
* **Spastic CP classifications (by limbs affected)**:
  * **Monoplegia**: one limb affected.
  * **Hemiplegia**: one side of body affected (one arm + one leg).
  * **Quadriplegia**: all four limbs affected.
  * **Diplegia**: only lower limbs affected.
* **Coaching implications—Mobility & Comfort**:
  * **Stretching** should be a **priority**; evidence suggests consistent stretching can **reduce spasticity**.
  * Athletes with CP may need to **hold stretches longer** than non‑disabled athletes for effectiveness.
  * Spasticity can be **painful** and contribute to **poor/stooped posture**, potentially leading to **back pain** or **scoliosis**.
* **Primitive reflexes & communication**:
  * Some athletes may retain **primitive reflexes** (e.g., **Moro reflex**: sudden backward jerk of head/upper body) which can affect performance.
  * **Communication difficulties** may be present → use **non‑verbal methods** (e.g., **video feedback with captions**, show **performance outcomes**) to connect movement with results.

### Hearing Impairment
* **Etiology**: May result from **neural damage** to cranial nerves or **inner‑ear structures**.
* **Primary coaching challenge**: **Communication** (verbal feedback difficult).
* **Athlete adaptations**: Greater reliance on **vision** and **proprioception** (body position sense).
* **Coaching strategies**:
  * Learn/use **sign language** where possible.
  * Provide **video feedback** with **clear, written captions** for instruction and analysis.

### Vision Impairment
* **Range**: **Partial** to **complete** loss of sight; athletes rely more on **hearing**, **touch**, and **kinesthetic awareness**.
* **Specialised equipment/adaptations**:
  * **Auditory balls** (e.g., football/cricket balls with **bells** inside) to track movement by sound.
* **Guides (sport‑specific)**:
  * In sports like **track & field** or **tandem cycling**, a **guide** is essential—acts as the athlete’s **eyes**.
  * Guides must **train alongside** athletes to develop **synergy** and **keep pace**.
* These adaptations enable athletes with vision impairment to **compete at a high level**.

### Summary & Integration Principles (Para‑athletes and Non‑disabled)
* **Individualize**: Coach each athlete based on **individual needs and requirements**.
* **Treat similarly where possible**: Approach para‑athletes the **same** as other athletes whenever feasible.
  * As noted with the **high‑performance swimming program**, the process—**assess strengths/weaknesses → develop program → monitor progress**—is **fundamentally the same** for **para‑athletes** and **non‑disabled** athletes.
* **Inclusion**: Strive to **integrate** athletes with a disability into **mainstream sport** when feasible.
  * Many have had **fewer opportunities** to engage in sport → limits **athletic development** and **overall health**.
  * Sport can **improve self‑esteem**, **develop communication skills**, and **foster belonging**.



# Week 12 Training File - Future Trends in Sport: Data Analytics, AI in Sport, and Recent Technology (Super Shoes)

## Overview
  * **Part 1 (this transcript):** **Data analytics in sport** — how large data sets inform coaching; decision-making; a match‑tactic case study; visualizing data via **custom dashboards** for coaching, player transfers, and exercise selection.
  * **Part 2 (next transcript):** **Artificial intelligence in sport** — use in **officiating** and **training programming**.
  * **Part 3 (final transcript):** **Recent technology** — the running **“super shoes”**, their **history**, and **performance impact**.
---

## Transcript 1 — Data Analytics in Sport

### Why Data? Data‑Informed Decision Making
* **Primary purpose:** Help coaches **make better decisions**.
* **Traditional (“old school”) approach:** Relied on the **coach’s eye** (subjective opinion).
  * Decisions made via **consultation** among head coach, S&C coach, physio, and staff.
  * Final calls often based on **subjective assessments** and **personal experience** → subject to **bias**.
* **Modern approach:** Use **objective numbers/measures** to **inform** decisions.
  * Data is a **tool to assist**, **not replace** the coach; helps **reduce bias** in subjective decision‑making.
* **Common coaching decisions noted in transcript:**
  * **Training load adjustments** to stimulate adaptation.
  * **Return‑to‑play** timing after injury.
  * **In‑game substitutions** (who and when).
  * **Player transfers** and **exercise selection** (gym/field) to elicit specific adaptations.

### The Four Types of Analytics (Value vs Difficulty Framework)
* **Descriptive** — **What happened?**
  * Example: Use **GPS match data** to summarize **distance** and **speeds** run by players.
* **Diagnostic** — **Why did it happen?**
  * Example: If players ran more than usual, analyze **opposition video**; a **high press** may force more running to create space.
* **Predictive** — **What will happen?**
  * Harder due to **natural variability** in data.
  * Example: Analyze **upcoming opponents’ tactics** to **predict higher running‑load** games → **adjust training week** accordingly.
* **Prescriptive** — **How do we make it happen?**
  * Most complex; requires a **large, long‑term data bank** linking **specific training activities** to **performance adaptations**.
  * Example: If a **high‑volume running game** is predicted, select **training drills** that best prepare players, based on historical response patterns.

### The Process of Data Analytics in Sport
1. **Collect data.**
   * Examples in transcript:
     * **GymAware** system — tracks **barbell velocity** to monitor **power output** and **fatigue**.
     * **Force plates** — measure **ground reaction forces** during jumps to assess **fatigue** and **adaptation**.
2. **Store, secure, clean, and transform data.**
   * **Secure storage** prevents **unauthorized access/changes** that could lead to poor decisions.
   * **Cleaning** removes errors/noise.
   * **Transformations** may be needed (e.g., divide **strength output by body weight** to compare heavier vs lighter athletes more validly).
3. **Visualize and analyze.**
   * Can be **real‑time** or **offline** after events.
   * **Offline example:** **Passing networks** in football — thicker lines indicate **more frequent passes**; helps understand **ball progression** and **key players** → informs **match tactics**.
4. **Consult & act.**
   * Discuss analyzed outputs with the **coaching team** and select the **appropriate course of action**, then **execute**.

### Case Study — Data‑Informed Match Tactics (Football)
* **Stadium tracking setup:**
  * Many professional stadiums use **multiple cameras** (often **≥6**) to **automatically track players**.
  * **AI technology** tracks each player; a **human analyst** oversees for accuracy.
  * Cameras record at **25 Hz** (25 data points/second/player).
  * With **known field dimensions**, compute **distance**, **velocity**, **acceleration** — producing **>4 million data points per game**.
* **Brentford FC context (English Premier League):**
  * **Newly promoted** club with a **smaller budget** → struggled to afford high‑profile attackers.
  * Tactical problem: Many top teams employ a **high press**, pressuring the ball carrier in the defensive half.
    * **Breaking the press** creates space in attack but requires **high technical ability**.
* **Data‑informed solution:** Play **direct (“route one”)** with **long balls** to **bypass** the press.
  * **StatsBomb “hops”** metric measures how often a player **wins aerial balls** vs an average player.
  * **Ivan Toney**: **hops = 6.65** → expected to **win aerial duels ≈65%** of the time; **97th percentile** among attackers.
  * **Tactical adjustment:** Increase **long‑pass percentage** vs high‑press opponents.
  * Look for **long, diagonal balls** to Toney, who can **head down** to an attacker exploiting space behind pressing defenders.
* **Example vs Manchester City (2022–23):**
  * Brentford used Toney to **run into space**, often on the **opposite side** from where a **free kick** was taken.
  * Toney contested **19 aerial duels**, **won 9**.
  * Predictive model (based on **hops**) forecast **8.83** wins → **remarkable accuracy**.
  * By winning long balls, Brentford progressed upfield and created **goal‑scoring chances** → **historic 2–1 away victory**.
  * **Return fixture:** Similar tactic **used again** and Brentford **won again**, illustrating how data analytics can **devise & execute** a tactic to achieve an otherwise unlikely result.

### Data as a Tool, Not a Rule
* **Balanced approach:** Combine **objective data** with **subjective experience/coach’s eye** to improve outcomes.
* **Limitations & realities:**
  * **Prediction models** can be **inaccurate**, especially with **highly variable data**.
  * Building **valid/reliable models** requires **massive datasets** — often **unavailable** at **lower competition levels**.
  * **Model lag**: Decision models are **behind the data**; e.g., if you wait for a model to confirm a player’s success before buying, their **price has already risen** due to performance.
  * Therefore, **subjective opinion** remains important for **timely predictions** **ahead** of the data.

### Coach’s Quick Checklist (Transcript 1)
* Define the **decision**; select **relevant data**.
* Ensure **secure storage**, **cleaning**, and appropriate **transformations** (e.g., normalize by body weight).
* Use **descriptive → diagnostic → predictive → prescriptive** pipeline where possible.
* Build **visuals** (e.g., passing networks) to support **tactics** and **selection** decisions.
* In‑game: leverage **tracking data** (25 Hz, multi‑camera) and **analyst oversight**.
* Match tactics: align personnel strengths (e.g., **aerial duel winners**) with **tactical patterns** (e.g., **long diagonals** vs high press).
* Remember: **Data assists, doesn’t replace** the coach; weigh **context** and **experience**.

---


## Transcript 2 — Artificial Intelligence in Sport

### AI in Officiating (Football Offside)
* **Offside rule (context from transcript):** At the moment an attacker receives a pass, there must be **≥2 defensive players** (often including the goalkeeper) **between the attacker and the goal**.
* **Old challenge:** **Perspective error** — human officials may lack the ideal vantage point for an accurate call in a **fast‑moving** game.
* **Semi‑automated offside technology** (two key data sources):
  1) **Instrumented ball** with an **internal sensor** broadcasting **XY coordinates at 500 Hz (500×/s)**.
  2) **Multi‑camera pose recognition** that tracks every player and generates a **3D model** (maps **X, Y, Z** coordinates of body segments) via **triangulation**.
* **Process:** Combine ball + player positional data to reconstruct any moment in **3D**.
  * **“Semi‑automated”** because a **Video Assistant Referee (VAR)** still **manually draws lines** on the 3D model, aligning with the **last body segment** of relevant attacking/defensive players to judge offside.
* **Caveat (human element):** **Tottenham vs Liverpool — Oct 3, 2023**: a goal was **incorrectly disallowed for offside**.
  * Error source: **human communication failure**, not the AI system. **Referee** restarted play **before** the VAR correctly communicated the **onside** decision.
  * **Takeaway:** Advanced tech aids accuracy, but **human protocols** remain critical.

### AI in Training Programming
* **Use case:** Automating parts of the **program‑design** workload for coaches.
* **Example mentioned:** **Coach Cat AI** (for **triathlon** and **cycling** training plans).
  * **Inputs:** Athlete’s **available weekly training time** and the **target event**.
  * **Outputs:** Detailed program specifying **frequency**, **duration**, and **type** of training.
* **Wearables & physiology integration:**
  * Pulls **heart rate**, **sleep duration**, and **heart rate variability (HRV)**.
  * **HRV** = variation in time between consecutive heartbeats; **higher HRV** → generally **less stressed**, better **recovery**. **Lower HRV** → more **stress**.
  * App computes a daily **“readiness to train”** score.
  * **Post‑session feedback** includes **training stress** and **power output (watts)**.
* **Limitations & the coach’s role 🧠:**
  * Example from transcript: App **cleared an athlete to train** because **HRV was above baseline**, despite **<6 hours sleep**.
    * The app saw sleep as an **improvement vs baseline**, but a human coach would flag **overall low sleep** and prioritize **sleep intervention**.
  * **Data quality issues:**
    * Wearables can **underestimate sleep latency** → **overestimate total sleep**.
    * **HRV validity** can be **questionable** when derived from **short recordings** (e.g., ~**30 s**), common in many wearables.
* **Bottom line:** AI can **save time** and **automate planning**, but the coach must **interpret data in context**, **interact with the athlete**, and make the **final decision** on **load** and **recovery**.

### Coach’s Quick Checklist (Transcript 2)
* **Officiating systems:** Ensure **VAR communication protocols** are followed; treat tech outputs as **decision aids**.
* **Training apps:** Treat AI‑generated plans as **drafts**; **customize** based on athlete history and context.
* **Readiness signals:** Do **not** let a single metric (e.g., **HRV**) override **sleep duration/quality** and **subjective state**.
* **Wearables hygiene:** Be aware of **sleep measurement biases** and **short‑window HRV** limitations; prefer **standardized** collection times/conditions.
* **Coach–athlete dialogue:** Use AI to inform, then **validate with conversation** and **observed response**.

* Will cover: **AI in officiating** and **AI‑assisted training programming**.
* Will be integrated here in the same style once provided.


## Transcript 3 — Recent Technology: “Super Shoes” in Running

### What Are “Super Shoes”?
* **Primary components (from transcript):**
  * A **stiff carbon fibre sole plate** embedded in the middle of the shoe.
  * A **large, specialised foam base** surrounding the plate.
* **Three main performance mechanisms:**
  1) **Optimise musculoskeletal function** to **minimise fatigue**.
  2) **Maximise energy return** during **push‑off**.
  3) **Minimise energy loss** at **foot‑ground contact**.

### Brief History & Competitive Context
* **2016 Rio Olympics:** First appeared as a **“hidden release.”**
* **2017:** Public release as **Nike Vaporfly 4%**.
* **2019:** **Eliud Kipchoge** (later model) runs first‑ever **sub‑2‑hour marathon** in an **unofficial** event.
* **Tokyo 2020 Olympics** (held **2021**): Widespread use → **backlash** on fairness/integrity → **World Athletics** introduces **new footwear regulations**.
* **Current dominance:** Winners of major events (e.g., **New York** and **Chicago** marathons) are **wearing super shoes**.

### Adoption, Equity & Performance Patterns
* Steep **adoption increase** among elite marathoners after **2017** release.
* **Performance enhancement appears linear**—improves an athlete’s **existing level**, not elevating a slower runner above a faster one.
* **Equity issues:** Athletes sponsored by brands **without** super‑shoe tech were **disadvantaged**.
  * Example: A **top Spanish marathoner** broke contract with **Adidas** to wear **Nike** to seek **Olympic qualification** → spurred **other brands** to develop their own versions.

### Performance Impact & Individual Variability
* On average, super shoes improve **running economy ~4%** → translates to **~2% faster performance time**.
  * Example: **2:05:00** marathon → **~2:02:30**.
* **Individual variability**: Some runners **up to ~6%** efficiency gains; **others** may see **no benefit**.

### How They Work — Biomechanics (Coaching‑Relevant)
* **Load absorption at the MTP joint** (ball of foot):
  * The **carbon plate** increases distance from the **axis of rotation**, acting as a **more effective lever** for **force absorption** → **reduces energetic cost** for tissues.
* **Propulsion at the ankle**:
  * The **stiff plate** makes the **ankle** a more effective **lever** during **push‑off** → increases **ground reaction force** → lowers **metabolic cost** for key running muscles (e.g., **calves**) → sustain **faster speeds longer**.

### World Athletics Regulations (Events ≥800 m)
* **Sole thickness ≤ 40 mm**.
* **Only one rigid plate** allowed (**no stacking**).
* **No sensing or intelligent technology** in the shoe.

### Coaching Considerations Raised in the Transcript
* **Training & Programming**
  * Should athletes **train in non‑compliant (“illegal”) shoes** that offer greater efficiency to **increase training stress/adaptation**?
  * Because shoes **lower HR at a given speed**, reconsider **heart‑rate zone–based** prescriptions for sessions.
* **Technique Modification**
  * Benefits may be **greater for forefoot strikers** (more efficient ankle lever).
  * Should coaches **modify technique** from **midfoot → forefoot** to maximise effects?
* **Injury Risk**
  * **Long‑term effects unknown** (no long‑term studies yet).
  * Some research suggests an **association** with **markers related to injury risk**.
  * Decide **how often** athletes should wear super shoes to **balance performance** vs **potential injury risk**.

### Closing Notes (from transcript)
* **“OMG – We’re done with new content!”** Next week is **revision**—**check it out**.
* **End of week twelve** → time to **delve into week 13** and **get your knowledge pristine** *(“yes I nailed that one!”)*

### Coach’s Quick Checklist (Transcript 3)
* Verify **event‑legal** footwear (≤40 mm sole; single plate; no sensing/intelligent tech).
* Decide when to **deploy** super shoes (races, key sessions) vs **withholding** for training load goals.
* If using **HR‑based** prescriptions, adjust for **lower HR at same speeds** in super shoes.
* Consider **strike pattern** implications (forefoot vs midfoot) and whether technique changes are warranted **for that athlete**.
* Monitor for **injury‑risk markers**; modulate **exposure frequency** accordingly.

 `.trim();

    // --- SYSTEM PROMPT BUILDER (Restored) ---
    function buildSystemPrompt() {
      return `
Your role:
- You are the SPX102 INTRODUCTION TO COACHING course chatbot. Answer only from the provided notes. You may respond in the same language the user uses to ask the question, or switch to the language the user asks you to use. 

You MUST follow these rules exactly:

1. PRIORITISE SAFETY OF THE USER
   - If the user appears to be in immediate danger, at risk of harming themselves, or describes serious harm from others:
     - Do NOT provide clinical advice.
     - Encourage them to seek urgent help.
     - Provide specific contacts such as:
       - Emergency services (e.g., call 000 in Australia).
       - National mental health helplines (e.g., Lifeline 13 11 14 in Australia).
       - Campus security and student support services (the teaching team will configure these for you).
   - Be warm, supportive, and non-judgemental.

2. ABSOLUTE SAFETY RESTRICTIONS
   - You must NEVER:
     - Provide instructions, methods, or encouragement for self-harm or suicide.
     - Provide guidance on illegal drugs, their manufacture, or their unsafe use.
     - Provide instructions for violence, weapons, or harming others.
   - If asked, clearly refuse and, where appropriate, gently steer the conversation to safety and wellbeing or back to course-related content.

3. STYLE
   - Use clear, concise explanations. Your responses should not exceeed 400 tokens unless absolutely necessary. 
   - When explaining difficult concepts, use simple examples aimed at university students.
   - When describing workflows, display the steps as a vertical list with emoji bullet points. Use bold headers for the action on each bullet, followed by details. Put "Tools" and "Why" on separate lines under the header.
   - If you provide follow-up prompts, they must be answerable using the knowledge base and aligned with the course content.

4. FOLLOW-UP PROMPTS (REQUIRED)
   - Always include at least one follow-up prompt.
   - Provide up to three prompts, in this order when appropriate:
     1) Socratic tutor question
     2) Request for a specific example
     3) Lucky dip: short story or poem
   - If a type is not appropriate, omit it. Ensure at least one prompt remains.
   - When you include follow-ups, append them AFTER the main answer as a JSON array between the markers:
     <<<FOLLOWUPS>>>
     [{"type":"socratic","text":"..."},{"type":"example","text":"..."},{"type":"lucky_dip","text":"Lucky dip - short story or poem"}]
     <<<END_FOLLOWUPS>>>
   - If no follow-ups, omit the markers entirely.

KNOWLEDGE BASE (sole source of truth):
${knowledgeBase}
      `.trim();
    }

    // --- UI HELPER FUNCTIONS ---
    
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function applyInlineFormatting(text) {
      const cleaned = text
        .replace(/<br\s*\/?>/gi, " ")
        .replace(/\u00a0|&nbsp;/gi, " ")
        .replace(/\s{2,}/g, " ");
      const escaped = escapeHtml(cleaned);
      const bolded = escaped.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
      return bolded.replace(/_(.*?)_/g, "<em>$1</em>");
    }

    function renderTable(lines, startIndex) {
      const rows = [];
      let i = startIndex;
      while (i < lines.length && lines[i].trim().startsWith("|")) {
        const row = lines[i]
          .trim()
          .replace(/^\||\|$/g, "")
          .split("|")
          .map((cell) => applyInlineFormatting(cell.trim()));
        rows.push(row);
        i++;
      }

      let header = [];
      let body = rows;

      if (rows.length > 1 && rows[1].every((cell) => /^-+$/.test(cell.replace(/<.*?>/g, "")))) {
        header = rows[0];
        body = rows.slice(2);
      }

      const headerHtml = header.length
        ? `<thead><tr>${header.map((cell) => `<th>${cell}</th>`).join("")}</tr></thead>`
        : "";
      const bodyHtml = body
        .map((row) => `<tr>${row.map((cell) => `<td>${cell}</td>`).join("")}</tr>`)
        .join("");

      return { html: `<table class="rich-text-table">${headerHtml}<tbody>${bodyHtml}</tbody></table>`, nextIndex: i - 1 };
    }

    function formatMessage(content) {
      const lines = content.trim().split("\n");
      let html = '<div class="rich-text space-y-2">';
      let inUl = false;
      let inOl = false;

      const closeLists = () => {
        if (inUl) {
          html += "</ul>";
          inUl = false;
        }
        if (inOl) {
          html += "</ol>";
          inOl = false;
        }
      };

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) {
          closeLists();
          continue;
        }

        // Tables
        if (line.startsWith("|")) {
          closeLists();
          const { html: tableHtml, nextIndex } = renderTable(lines, i);
          html += tableHtml;
          i = nextIndex;
          continue;
        }

        // Headings
        if (/^#{1,6}\s+/.test(line)) {
          closeLists();
          const level = line.match(/^#+/)[0].length;
          const text = applyInlineFormatting(line.replace(/^#{1,6}\s+/, ""));
          html += `<h${Math.min(level + 1, 4)}>${text}</h${Math.min(level + 1, 4)}>`;
          continue;
        }

        // Divider
        if (/^(-\s*){3,}$/.test(line)) {
          closeLists();
          html += "<hr/>";
          continue;
        }

        // Ordered List
        const orderedMatch = line.match(/^\d+\.\s+(.*)/);
        if (orderedMatch) {
          if (!inOl) {
            closeLists();
            inOl = true;
            html += '<ol class="pl-4">';
          }
          html += `<li>${applyInlineFormatting(orderedMatch[1])}</li>`;
          continue;
        }

        // Unordered List
        const unorderedMatch = line.match(/^[-*]\s+(.*)/);
        if (unorderedMatch) {
          if (!inUl) {
            closeLists();
            inUl = true;
            html += '<ul class="pl-4">';
          }
          html += `<li>${applyInlineFormatting(unorderedMatch[1])}</li>`;
          continue;
        }

        // Paragraph / Card block
        closeLists();
        const paragraph = applyInlineFormatting(line);
        const isEmphasized = paragraph.startsWith("<strong>") || paragraph.toLowerCase().startsWith("note:");
        html += `<div class="${isEmphasized ? "card-block" : ""}"><p>${paragraph}</p></div>`;
      }

      closeLists();
      html += "</div>";
      return html;
    }

    function setToggleState(button, isActive) {
      button.setAttribute("aria-pressed", isActive);
      const highlightClasses = [
        "ring-4",
        "ring-offset-2",
        "ring-offset-white",
        "ring-[var(--color-secondary)]",
        "border-[var(--color-secondary)]",
        "bg-[var(--color-secondary)]/20",
        "shadow-lg",
        "shadow-yellow-200/80",
      ];

      highlightClasses.forEach((cls) => button.classList.toggle(cls, isActive));
    }

    function collectChatEntries() {
      const entries = [];
      chatLog.querySelectorAll(".msg-user, .msg-bot").forEach((node) => {
        const role = node.classList.contains("msg-user") ? "You" : "Coach Ross";
        const contentNode = node.classList.contains("msg-user")
          ? node
          : node.querySelector("[data-role='bot-content']");
        const content = contentNode?.innerHTML.trim() || "";
        if (content) {
          entries.push({ role, content });
        }
      });
      return entries;
    }

    function downloadChat() {
      const entries = collectChatEntries();
      if (!entries.length) {
        errorSpan.textContent = "No chat to download yet.";
        return;
      }
      errorSpan.textContent = "";
      window.print();
    }

    function updatePendingFocusInstruction() {
      const { clinical, sports } = focusState;
      if (clinical && sports) {
        pendingFocusInstruction = "use examples specific to sports related clinical exercise physiology";
      } else if (clinical) {
        pendingFocusInstruction = "use an example appropriate to clinical exercise physiology that is not sports related";
      } else if (sports) {
        pendingFocusInstruction = "use an example appropriate to sports that is not clinical exercise physiology related";
      } else {
        pendingFocusInstruction = "";
      }
    }

    function addUserMessage(content, attachmentName) {
        const attachmentHtml = attachmentName
          ? `
            <div class="mt-2 inline-flex items-center gap-1 rounded-full bg-white/70 px-2 py-1 text-[11px] text-slate-700">
              <i data-lucide="file-text" class="w-3.5 h-3.5"></i>
              <span>${escapeHtml(attachmentName)}</span>
            </div>
          `
          : "";
        const div = document.createElement("div");
        div.className = "flex gap-4 flex-row-reverse animate-[fadeIn_0.3s_ease-out]";
        div.innerHTML = `
            <div class="space-y-1 max-w-[85%]">
                <div class="msg-user bg-[var(--color-secondary)] text-black p-4 text-sm leading-relaxed shadow-lg">
                    ${formatMessage(content)}
                    ${attachmentHtml}
                </div>
                <div class="mt-2 flex items-center justify-end gap-2 text-xs text-slate-600">
                  <button type="button" class="copy-button inline-flex h-8 w-8 items-center justify-center rounded-full shadow-sm" data-role="copy-button" aria-label="Copy message text" title="Copy text">
                    <i data-lucide="copy" class="w-4 h-4"></i>
                  </button>
                  <span>Copy</span>
                </div>
            </div>
        `;
        chatLog.appendChild(div);
        const contentEl = div.querySelector(".msg-user");
        const copyButton = div.querySelector("[data-role='copy-button']");
        wireCopyButton(copyButton, contentEl);
        chatLog.scrollTop = chatLog.scrollHeight;
        lucide.createIcons();
    }

    function scrollMessageToTop(element) {
        const containerRect = chatLog.getBoundingClientRect();
        const elementRect = element.getBoundingClientRect();
        const offset = elementRect.top - containerRect.top + chatLog.scrollTop;
        chatLog.scrollTo({ top: offset, behavior: "smooth" });
    }

    function addBotMessage(content) {
        const div = document.createElement("div");
        div.className = "flex gap-4 animate-[slideIn_0.3s_ease-out]";
        div.innerHTML = `
             <img src="./ross pic.png"
                  class="w-10 h-10 rounded-full object-cover border border-slate-200 flex-none self-end mb-1"
                  alt="Ross Clark"
                  onerror="this.src='https://ui-avatars.com/api/?name=Ross+Clark&background=6366f1&color=fff'">
            <div class="space-y-1 max-w-[85%]">
                <div class="text-xs text-slate-500 ml-1">Ross Clark</div>
                <div class="flex items-start gap-2">
                  <div class="msg-bot bg-white border border-slate-200 p-4 text-sm leading-relaxed shadow-sm text-slate-800">
                      <div data-role="bot-content">${formatMessage(content)}</div>
                      <div data-role="followup-container" class="mt-3 flex flex-wrap gap-2 hidden"></div>
                  </div>
                  <button
                    type="button"
                    class="tts-button h-9 w-9 rounded-full flex items-center justify-center shadow-sm"
                    data-role="tts-button"
                    data-state="idle"
                    aria-label="Play message audio"
                    title="Play audio"
                    disabled>
                    <i data-lucide="volume-2" class="w-4 h-4"></i>
                  </button>
                </div>
                <div class="mt-2 flex items-center gap-2 text-xs text-slate-500">
                  <button type="button" class="copy-button inline-flex h-8 w-8 items-center justify-center rounded-full shadow-sm" data-role="copy-button" aria-label="Copy message text" title="Copy text">
                    <i data-lucide="copy" class="w-4 h-4"></i>
                  </button>
                  <span>Copy</span>
                </div>
            </div>
        `;
        chatLog.appendChild(div);
        const contentEl = div.querySelector("[data-role='bot-content']");
        const ttsButton = div.querySelector("[data-role='tts-button']");
        const copyButton = div.querySelector("[data-role='copy-button']");
        const followupContainer = div.querySelector("[data-role='followup-container']");
        ttsButton.addEventListener("click", () => handleTtsButtonClick(ttsButton));
        wireCopyButton(copyButton, contentEl);
        lucide.createIcons();
        scrollMessageToTop(contentEl);
        return { contentEl, ttsButton, followupContainer };
    }

    function setCopyButtonState(button, state) {
      button.dataset.state = state;
      if (state === "copied") {
        button.setAttribute("aria-label", "Copied message text");
        button.setAttribute("title", "Copied");
        button.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i>';
      } else {
        button.setAttribute("aria-label", "Copy message text");
        button.setAttribute("title", "Copy text");
        button.innerHTML = '<i data-lucide="copy" class="w-4 h-4"></i>';
      }
      lucide.createIcons();
    }

    async function copyMessageContent(contentEl, button) {
      if (!contentEl || !button) return;
      const selection = window.getSelection();
      if (selection) {
        selection.removeAllRanges();
        const range = document.createRange();
        range.selectNodeContents(contentEl);
        selection.addRange(range);
      }
      const text = contentEl.innerText.trim();
      try {
        await navigator.clipboard.writeText(text);
      } catch (error) {
        try {
          document.execCommand("copy");
        } catch (fallbackError) {
          console.error("Copy failed", fallbackError);
        }
      }
      setCopyButtonState(button, "copied");
      setTimeout(() => setCopyButtonState(button, "idle"), 2000);
    }

    function wireCopyButton(button, contentEl) {
      if (!button || !contentEl) return;
      button.addEventListener("click", () => copyMessageContent(contentEl, button));
    }

    const initialCopyButton = chatLog.querySelector("[data-role='copy-button']");
    const initialContent = chatLog.querySelector("[data-role='bot-content']");
    if (initialCopyButton && initialContent) {
      setCopyButtonState(initialCopyButton, "idle");
      wireCopyButton(initialCopyButton, initialContent);
    }

    function setTtsButtonState(button, state) {
      button.dataset.state = state;
      if (state === "loading") {
        button.setAttribute("aria-label", "Stop message audio");
        button.setAttribute("title", "Stop audio");
      } else {
        button.setAttribute("aria-label", "Play message audio");
        button.setAttribute("title", "Play audio");
      }
    }

    function setTtsButtonText(button, text) {
      button.dataset.ttsText = text;
      button.disabled = !text;
    }

    function clearTtsHighlights(container) {
      if (!container) return;
      const highlights = container.querySelectorAll(".tts-highlight");
      highlights.forEach((highlight) => {
        const textNode = document.createTextNode(highlight.textContent || "");
        highlight.replaceWith(textNode);
      });
      container.normalize();
    }

    function getTextNodesWithOffsets(container) {
      const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT);
      const nodes = [];
      let index = 0;
      let node;
      while ((node = walker.nextNode())) {
        const value = node.nodeValue || "";
        const length = value.length;
        if (length) {
          nodes.push({ node, start: index, end: index + length });
          index += length;
        }
      }
      return nodes;
    }

    function getContainerText(container) {
      if (!container) return "";
      const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT);
      let text = "";
      let node;
      while ((node = walker.nextNode())) {
        text += node.nodeValue || "";
      }
      return text;
    }

    function highlightTextRange(container, start, end) {
      if (!container) return;
      clearTtsHighlights(container);
      if (start >= end) return;
      const nodes = getTextNodesWithOffsets(container);
      nodes.forEach(({ node, start: nodeStart, end: nodeEnd }) => {
        if (nodeEnd <= start || nodeStart >= end) return;
        let workingNode = node;
        const startOffset = Math.max(start - nodeStart, 0);
        const endOffset = Math.min(end - nodeStart, workingNode.nodeValue.length);
        if (endOffset < workingNode.nodeValue.length) {
          workingNode.splitText(endOffset);
        }
        if (startOffset > 0) {
          workingNode = workingNode.splitText(startOffset);
        }
        const highlightSpan = document.createElement("span");
        highlightSpan.className = "tts-highlight";
        highlightSpan.textContent = workingNode.nodeValue;
        workingNode.replaceWith(highlightSpan);
      });
    }

    function splitIntoSentences(text) {
      const sentences = [];
      if (!text) return sentences;
      const regex = /[^.!?;:]+[.!?;:]+(?:["'”’]+)?|[^.!?;:]+$/g;
      let match;
      let offset = 0;
      while ((match = regex.exec(text)) !== null) {
        const chunk = match[0];
        const trimmed = chunk.trim();
        if (!trimmed) {
          offset += chunk.length;
          continue;
        }
        const leadingWhitespace = chunk.indexOf(trimmed);
        const start = offset + leadingWhitespace;
        const end = start + trimmed.length;
        sentences.push({ text: trimmed, start, end });
        offset += chunk.length;
      }
      return sentences;
    }

    function stopActiveAudio({ resumeMic = true } = {}) {
      ttsPlaybackToken += 1;
      if (activeAudio) {
        activeAudio.pause();
        activeAudio.currentTime = 0;
      }
      if (activeUtterance && "speechSynthesis" in window) {
        window.speechSynthesis.cancel();
      }
      if (activeTtsButton) {
        setTtsButtonState(activeTtsButton, "idle");
      }
      if (activeTtsContentEl) {
        clearTtsHighlights(activeTtsContentEl);
      }
      activeAudio = null;
      activeTtsButton = null;
      activeUtterance = null;
      activeTtsContentEl = null;
      if (resumeMic) {
        resumeRecognitionAfterTts();
      }
    }

    function detectLanguageTag(text) {
      const sample = text.slice(0, 500);
      if (/[\u4e00-\u9fff]/.test(sample)) return "zh";
      if (/[\u3040-\u30ff]/.test(sample)) return "ja";
      if (/[\uac00-\ud7af]/.test(sample)) return "ko";
      if (/[\u0400-\u04ff]/.test(sample)) return "ru";
      if (/[\u0600-\u06ff]/.test(sample)) return "ar";
      if (/[\u0900-\u097f]/.test(sample)) return "hi";
      if (/[\u0590-\u05ff]/.test(sample)) return "he";
      if (/[\u0e00-\u0e7f]/.test(sample)) return "th";
      if (/[¿¡ñáéíóúü]/i.test(sample)) return "es";
      if (/[àâçéèêëîïôùûüÿœ]/i.test(sample)) return "fr";
      return "en";
    }

    function refreshVoices() {
      if (!("speechSynthesis" in window)) return;
      availableVoices = window.speechSynthesis.getVoices() || [];
    }

    function selectSpeechSynthesisVoice(lang) {
      if (!availableVoices.length) refreshVoices();
      const normalized = lang.toLowerCase();
      return (
        availableVoices.find((voice) => voice.lang?.toLowerCase().startsWith(normalized)) ||
        availableVoices.find((voice) => voice.lang?.toLowerCase().startsWith(normalized.split("-")[0])) ||
        null
      );
    }

    async function playBrowserSpeech(text, lang, button, contentEl) {
      if (!("speechSynthesis" in window)) {
        throw new Error("Speech synthesis is not available.");
      }
      pauseRecognitionForTts();
      stopActiveAudio({ resumeMic: false });
      const playbackToken = ttsPlaybackToken;
      setTtsButtonState(button, "loading");
      const sentences = splitIntoSentences(text);
      if (!sentences.length) {
        setTtsButtonState(button, "idle");
        resumeRecognitionAfterTts();
        return;
      }
      activeTtsButton = button;
      activeTtsContentEl = contentEl || null;
      try {
        return await new Promise((resolve, reject) => {
          let index = 0;
          const speakNext = () => {
            if (playbackToken !== ttsPlaybackToken) {
              resolve();
              return;
            }
            if (index >= sentences.length) {
              setTtsButtonState(button, "idle");
              if (activeTtsButton === button) activeTtsButton = null;
              activeUtterance = null;
              if (activeTtsContentEl) {
                clearTtsHighlights(activeTtsContentEl);
              }
              resolve();
              return;
            }
            const sentence = sentences[index];
            const utterance = new SpeechSynthesisUtterance(sentence.text);
            const voice = selectSpeechSynthesisVoice(lang);
            if (voice) utterance.voice = voice;
            utterance.lang = lang;
            utterance.rate = ttsSpeed;
            activeUtterance = utterance;
            if (activeTtsContentEl) {
              highlightTextRange(activeTtsContentEl, sentence.start, sentence.end);
            }
            utterance.onend = () => {
              if (playbackToken !== ttsPlaybackToken) {
                resolve();
                return;
              }
              index += 1;
              speakNext();
            };
            utterance.onerror = () => {
              setTtsButtonState(button, "idle");
              if (activeTtsButton === button) activeTtsButton = null;
              activeUtterance = null;
              if (activeTtsContentEl) {
                clearTtsHighlights(activeTtsContentEl);
              }
              reject(new Error("Unable to play the generated audio."));
            };
            window.speechSynthesis.speak(utterance);
          };
          window.speechSynthesis.cancel();
          speakNext();
        });
      } finally {
        resumeRecognitionAfterTts();
      }
    }

   // A simple queue to hold pre-fetched audio blobs
let audioQueue = [];

async function playTtsForText(text, button, contentEl) {
  const speechText = contentEl ? getContainerText(contentEl).trim() : text?.trim();
  if (!speechText) return;

  if (ttsEngine === "browser") {
    const lang = detectLanguageTag(speechText);
    await playBrowserSpeech(speechText, lang, button, contentEl);
    return;
  }

  pauseRecognitionForTts();
  stopActiveAudio({ resumeMic: false });
  const playbackToken = ttsPlaybackToken;
  setTtsButtonState(button, "loading");
  activeTtsButton = button;
  activeTtsContentEl = contentEl || null;
  
  const sentences = splitIntoSentences(speechText);
  audioQueue = []; // Reset queue

  try {
    for (let i = 0; i < sentences.length; i++) {
      if (playbackToken !== ttsPlaybackToken) break;
      const sentence = sentences[i];
      
      // 1. Fetch the current sentence if it's not already in the queue
      let audioBlob;
      if (audioQueue[i]) {
        audioBlob = audioQueue[i];
      } else {
        audioBlob = await fetchAudioBlob(sentence.text);
      }

      if (playbackToken !== ttsPlaybackToken) break;

      // 2. Start pre-fetching the NEXT sentence in the background (don't 'await' it)
      if (i + 1 < sentences.length) {
        fetchAudioBlob(sentences[i + 1].text).then(blob => {
          audioQueue[i + 1] = blob;
        });
      }

      // 3. Play the current audio and wait for it to finish
      await playAudioFromBlob(audioBlob, button, contentEl, sentence, playbackToken);
    }
  } catch (err) {
    console.error("TTS Queue Error:", err);
    errorSpan.textContent = "Playback error. Switching to browser speech.";
    const lang = detectLanguageTag(speechText);
    await playBrowserSpeech(speechText, lang, button, contentEl);
  } finally {
    if (playbackToken === ttsPlaybackToken) {
      setTtsButtonState(button, "idle");
      if (activeTtsContentEl) {
        clearTtsHighlights(activeTtsContentEl);
      }
      activeTtsButton = null;
      activeTtsContentEl = null;
    }
    resumeRecognitionAfterTts();
  }
}

// Helper to ONLY fetch the audio from your Netlify function
async function fetchAudioBlob(text) {
  const response = await fetch(HF_TTS_API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text, voice: HF_TTS_VOICES[ttsVoice], speed: ttsSpeed }),
  });

  if (!response.ok) throw new Error("Fetch failed");
  return await response.blob();
}

// Helper to ONLY play the audio and handle highlighting
function playAudioFromBlob(blob, button, contentEl, sentenceMetadata, playbackToken) {
  return new Promise((resolve, reject) => {
    const url = URL.createObjectURL(blob);
    activeAudio = globalAudioElement;

    if (playbackToken !== ttsPlaybackToken) {
      URL.revokeObjectURL(url);
      resolve();
      return;
    }

    if (contentEl && sentenceMetadata) {
      highlightTextRange(contentEl, sentenceMetadata.start, sentenceMetadata.end);
    }

    activeAudio.onended = () => {
      URL.revokeObjectURL(url);
      resolve();
    };
    activeAudio.onpause = () => {
      if (playbackToken !== ttsPlaybackToken) {
        URL.revokeObjectURL(url);
        resolve();
      }
    };
    activeAudio.onerror = (event) => {
      URL.revokeObjectURL(url);
      reject(event);
    };
    activeAudio.src = url;
    activeAudio.play().catch(reject);
  });
}

    async function handleTtsButtonClick(button) {
      const contentEl = button.closest(".space-y-1")?.querySelector("[data-role='bot-content']");
      const text = contentEl ? getContainerText(contentEl).trim() : button.dataset.ttsText?.trim();
      if (button.dataset.state === "loading") {
        autoTtsEnabled = false;
        stopActiveAudio();
        return;
      }
      if (autoTtsEnabled) {
        autoTtsEnabled = false;
        stopActiveAudio();
        return;
      }
      if (!text) return;
      autoTtsEnabled = true;
      errorSpan.textContent = "";
      if (!narrativeModeEnabled && contentEl) {
        await handleNarrativeModeRequest({ button, contentEl });
        return;
      }
      await playTtsForText(text, button, contentEl);
    }

    function setTyping(isTyping) {
      if (isTyping) {
        typingIndicator.classList.remove("hidden");
        sendBtn.disabled = true;
        sendBtn.classList.add("opacity-50", "cursor-not-allowed");
        chatLog.appendChild(typingIndicator); 
        chatLog.scrollTop = chatLog.scrollHeight;
      } else {
        typingIndicator.classList.add("hidden");
        sendBtn.disabled = false;
        sendBtn.classList.remove("opacity-50", "cursor-not-allowed");
      }
    }

    // --- LOGIC RESTORATION ---

    function initMessages() {
      messages = [
        {
          role: "system",
          content: buildSystemPrompt(),
        },
      ];
    }

    function updateSpeechOptionsUI() {
      if (speechSpeedSelect) {
        speechSpeedSelect.value = `${ttsSpeed}`;
      }
      if (speechEngineSelect) {
        speechEngineSelect.value = ttsEngine;
      }
      speechVoiceInputs.forEach((input) => {
        input.checked = input.value === ttsVoice;
        input.disabled = ttsEngine !== "huggingface";
      });
    }

    function truncateFileName(name, maxLength = 22) {
      if (!name) return "";
      if (name.length <= maxLength) return name;
      const extIndex = name.lastIndexOf(".");
      const ext = extIndex > -1 ? name.slice(extIndex) : "";
      const base = name.slice(0, maxLength - ext.length - 1);
      return `${base}…${ext}`;
    }

    function getSessionId() {
      const storageKey = "chat_session_id";
      const existing = localStorage.getItem(storageKey);
      if (existing) return existing;
      const generated =
        (window.crypto?.randomUUID && window.crypto.randomUUID()) ||
        `session_${Date.now()}_${Math.random().toString(16).slice(2)}`;
      localStorage.setItem(storageKey, generated);
      return generated;
    }

    async function logToFirebase(role, content) {
      try {
        await fetch("/.netlify/functions/log-chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: getSessionId(),
            role,
            content,
            timestamp: new Date().toISOString(),
          }),
        });
      } catch (err) {
        console.error("Failed to log to Firebase", err);
      }
    }

    function resetPdfAttachment() {
      pdfAttachment = null;
      if (pdfInput) {
        pdfInput.value = "";
      }
      if (pdfLabel) {
        pdfLabel.textContent = "PDF";
        pdfLabel.title = "";
      }
      if (pdfClearBtn) {
        pdfClearBtn.classList.add("hidden");
      }
    }

    function setPdfAttachment(file, dataUrl) {
      pdfAttachment = {
        name: file.name,
        dataUrl,
      };
      if (pdfLabel) {
        pdfLabel.textContent = truncateFileName(file.name);
        pdfLabel.title = file.name;
      }
      if (pdfClearBtn) {
        pdfClearBtn.classList.remove("hidden");
      }
    }
    
    // Initialise on load
    initMessages();

    // Set initial toggle appearance
    setToggleState(clinicalToggle, focusState.clinical);
    setToggleState(sportsToggle, focusState.sports);

    // Focus toggle interactions
    clinicalToggle.addEventListener("click", () => {
      focusState.clinical = !focusState.clinical;
      setToggleState(clinicalToggle, focusState.clinical);
      updatePendingFocusInstruction();
    });

    sportsToggle.addEventListener("click", () => {
      focusState.sports = !focusState.sports;
      setToggleState(sportsToggle, focusState.sports);
      updatePendingFocusInstruction();
    });

    // Crisis detection
    function looksLikeCrisis(text) {
      const lowered = text.toLowerCase();
      const keywords = ["kill myself", "suicide", "want to die", "end my life", "self harm", "self-harm", "hurt myself"];
      return keywords.some((k) => lowered.includes(k));
    }

    function crisisResponse() {
      return `I'm really glad you reached out — your safety is the most important thing.
      <br><br>
      I can't provide crisis counselling, but please consider these options right now:
      <br>• If you are in immediate danger call <strong>000</strong> (Australia).
      <br>• Contact <strong>Lifeline</strong> on <strong>13 11 14</strong>.
      <br>• If you are a student, please contact your university's student wellbeing team.
      <br><br>You do not have to go through this alone.`;
    }

    function normalizeFollowupText(text) {
      return text.trim().toLowerCase();
    }

    function getVisibleAssistantContent(rawText) {
      const startToken = "<<<FOLLOWUPS>>>";
      const endToken = "<<<END_FOLLOWUPS>>>";
      const startIndex = rawText.indexOf(startToken);
      const endIndex = rawText.indexOf(endToken);
      let cutIndex = -1;

      if (startIndex !== -1 && endIndex !== -1) {
        cutIndex = Math.min(startIndex, endIndex);
      } else if (startIndex !== -1) {
        cutIndex = startIndex;
      } else if (endIndex !== -1) {
        cutIndex = endIndex;
      }

      if (cutIndex === -1) {
        return rawText;
      }
      return rawText.slice(0, cutIndex).trimEnd();
    }

    function extractFollowupsFromContent(rawText) {
      const startToken = "<<<FOLLOWUPS>>>";
      const endToken = "<<<END_FOLLOWUPS>>>";
      const startIndex = rawText.indexOf(startToken);
      if (startIndex === -1) {
        const endIndex = rawText.indexOf(endToken);
        if (endIndex !== -1) {
          return { mainText: rawText.slice(0, endIndex).trim(), followups: [] };
        }
        return { mainText: rawText.trim(), followups: [] };
      }
      const endIndex = rawText.indexOf(endToken, startIndex + startToken.length);
      if (endIndex === -1) {
        return { mainText: rawText.slice(0, startIndex).trim(), followups: [] };
      }
      const jsonBlock = rawText
        .slice(startIndex + startToken.length, endIndex)
        .trim()
        .replace(/^```(?:json)?/i, "")
        .replace(/```$/i, "")
        .trim();
      let parsed = [];
      try {
        parsed = JSON.parse(jsonBlock);
      } catch (err) {
        parsed = [];
      }
      const mainText = rawText.slice(0, startIndex).trim();
      return { mainText, followups: Array.isArray(parsed) ? parsed : [] };
    }

    async function streamAssistantResponseInto({
      messagesToSend,
      contentEl,
      ttsButton,
      expectFollowups = true,
    }) {
      const decoder = new TextDecoder();
      let assistantContent = "";
      let buffer = "";
      let streamEnded = false;

      const includesFile = messagesToSend.some(
        (message) =>
          Array.isArray(message.content) &&
          message.content.some((part) => part?.type === "file")
      );
      const requestBody = {
        messages: messagesToSend,
        stream: true,
      };
      if (includesFile) {
        requestBody.plugins = [
          {
            id: "file-parser",
            pdf: {
              engine: "pdf-text",
            },
          },
        ];
      }

      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(requestBody),
      });

      if (!response.ok) {
        const rawText = await response.text();
        let backendMsg = "The server returned an error.";
        try {
          const parsed = JSON.parse(rawText);
          if (parsed?.error) {
            backendMsg =
              typeof parsed.error === "string"
                ? parsed.error
                : parsed.error.message || backendMsg;
          }
        } catch (e) {
          // ignore
        }
        errorSpan.textContent = "Error: " + backendMsg;
        const fallbackText = "Sorry, I couldn't generate a response just now.";
        contentEl.innerHTML = formatMessage(fallbackText);
        setTtsButtonText(ttsButton, fallbackText);
        return { assistantText: fallbackText, followups: [] };
      }

      const reader = response.body?.getReader();
      if (!reader) {
        throw new Error("Readable stream not available");
      }

      while (!streamEnded) {
        const { done, value } = await reader.read();
        if (done) break;

        buffer += decoder.decode(value, { stream: true });

        while (true) {
          const lineEnd = buffer.indexOf("\n");
          if (lineEnd === -1) break;

          const line = buffer.slice(0, lineEnd).trim();
          buffer = buffer.slice(lineEnd + 1);

          if (!line || line.startsWith(":")) continue;
          if (!line.startsWith("data: ")) continue;

          const dataStr = line.slice(6);
          if (dataStr === "[DONE]") {
            streamEnded = true;
            break;
          }

          try {
            const parsed = JSON.parse(dataStr);

            if (parsed?.error) {
              const msg =
                parsed.error?.message || "An error occurred during streaming.";
              errorSpan.textContent = "Error: " + msg;
              streamEnded = true;
              break;
            }

            const delta = parsed?.choices?.[0]?.delta?.content || "";
            if (delta) {
              assistantContent += delta;
              const visibleContent = expectFollowups
                ? getVisibleAssistantContent(assistantContent)
                : assistantContent;
              contentEl.innerHTML = formatMessage(visibleContent);
            }

            const finishReason = parsed?.choices?.[0]?.finish_reason;
            if (finishReason === "stop" || finishReason === "length") {
              streamEnded = true;
              break;
            }
          } catch (err) {
            // Ignore malformed SSE payloads
          }
        }
      }

      const { mainText, followups } = expectFollowups
        ? extractFollowupsFromContent(assistantContent)
        : { mainText: assistantContent.trim(), followups: [] };
      if (mainText) {
        contentEl.innerHTML = formatMessage(mainText);
        setTtsButtonText(ttsButton, mainText);
      }
      return { assistantText: mainText, followups };
    }

    async function streamAssistantResponse() {
      const { contentEl: botContentEl, ttsButton, followupContainer } = addBotMessage("");
      ttsButton.dataset.userPrompt = lastUserPrompt;
      const { assistantText, followups } = await streamAssistantResponseInto({
        messagesToSend: messages,
        contentEl: botContentEl,
        ttsButton,
      });
      if (assistantText && autoTtsEnabled) {
        await playTtsForText(assistantText, ttsButton, botContentEl);
      }
      return { assistantReply: assistantText, followups, followupContainer };
    }

    function clearFollowupSuggestions() {
      document.querySelectorAll("[data-role='followup-container']").forEach((container) => {
        container.innerHTML = "";
        container.classList.add("hidden");
      });
    }

    function renderFollowupSuggestions(container, suggestions) {
      clearFollowupSuggestions();
      if (!container) return;
      const order = ["socratic", "example"];
      const seenInResponse = new Set();
      const filteredSuggestions = order
        .map((type) => suggestions.find((item) => item?.type === type))
        .filter(Boolean)
        .filter((item) => {
          if (!item?.text) return false;
          const normalized = normalizeFollowupText(item.text);
          if (seenInResponse.has(normalized)) return false;
          seenInResponse.add(normalized);
          return true;
        })
        .slice(0, 2);
      if (!filteredSuggestions.length) {
        const fallbackText = `What's the most important takeaway from that answer?`;
        filteredSuggestions.push({ type: "socratic", text: fallbackText });
      }
      const luckyDipSuggestion = suggestions.find((item) => item?.type === "lucky_dip");
      const luckyDipText = luckyDipSuggestion?.text || "Lucky dip - short story or poem";
      filteredSuggestions.push({ type: "lucky_dip", text: luckyDipText });
      if (!filteredSuggestions.length) return;
      filteredSuggestions.forEach((suggestion) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className =
          "followup-button inline-flex items-center gap-2 rounded-full bg-[#0052C4] px-3 py-2 text-xs font-semibold text-white shadow-sm transition-colors hover:bg-[#1a73e8]";
        button.textContent = suggestion.text;
        button.addEventListener("click", () => {
          clearFollowupSuggestions();
          const luckyDipPrompts = [
            "Generate a short story based on the SPX102 coaching notes and our conversation so far.",
            "Generate a poem based on the SPX102 coaching notes and our conversation so far.",
          ];
          const nextPrompt =
            suggestion.type === "lucky_dip"
              ? luckyDipPrompts[Math.floor(Math.random() * luckyDipPrompts.length)]
              : suggestion.text;
          handleUserMessage(nextPrompt);
        });
        container.appendChild(button);
      });
      container.classList.remove("hidden");
    }

    async function handleNarrativeModeRequest({ button, contentEl }) {
      if (narrativeModeInFlight) return;
      narrativeModeInFlight = true;
      const narrativeInstruction =
        "Answer all further questions in narrative style with no tables or bullet points.";
      const narrativeUserInstruction =
        "You must respond in narrative format with no tables or bullet points.";
      const placeholderText =
        "I'm just converting this response to a better format for speech - I'll be ready soon and all further responses will be done like this straight away!";
      const originalText = button.dataset.ttsText?.trim() || "";
      const priorPrompt = button.dataset.userPrompt?.trim() || lastUserPrompt.trim();
      narrativeModeEnabled = true;
      messages.push({ role: "system", content: narrativeInstruction });

      contentEl.innerHTML = formatMessage(placeholderText);
      setTtsButtonText(button, "");
      setTtsButtonState(button, "loading");

      const narrativeRequest = priorPrompt
        ? `Please rewrite your last response in narrative form. Prior prompt:\n${priorPrompt}`
        : "Please rewrite your last response in narrative form.";
      const narrativeMessages = [
        ...messages,
        {
          role: "user",
          content: `${narrativeUserInstruction}\n\n${narrativeRequest}`,
        },
      ];

      try {
        const { assistantText } = await streamAssistantResponseInto({
          messagesToSend: narrativeMessages,
          contentEl,
          ttsButton: button,
          expectFollowups: false,
        });
        if (assistantText) {
          await playTtsForText(assistantText, button, contentEl);
        } else if (originalText) {
          contentEl.innerHTML = formatMessage(originalText);
          setTtsButtonText(button, originalText);
        }
      } catch (err) {
        console.error(err);
        if (originalText) {
          contentEl.innerHTML = formatMessage(originalText);
          setTtsButtonText(button, originalText);
        }
        errorSpan.textContent = "Could not reformat the response for speech.";
      } finally {
        narrativeModeInFlight = false;
      }
    }

    // --- SPEECH HELPERS ---
    function startSilenceTimer() {
      clearTimeout(silenceTimer);
      silenceTimer = setTimeout(() => finalizeSpeechInput(), 2000);
    }

    function finalizeSpeechInput() {
      clearTimeout(silenceTimer);
      silenceTimer = null;
      if (!speechBuffer.trim()) return;
      const spokenText = speechBuffer.trim();
      speechBuffer = "";
      // Prevent auto-restart when continuous mode hits the silence boundary
      if (speechMode === SpeechMode.CONTINUOUS) {
        pausedForResponse = true;
        stopListening();
      }
      handleUserMessage(spokenText, { triggeredBySpeech: true });
    }

    function handleSpeechResult(event) {
      let added = false;
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const result = event.results[i];
        if (!result?.isFinal) continue;
        const transcript = result[0].transcript.trim();
        if (!transcript || transcript === lastFinalTranscript) continue;

        const normalizedBuffer = speechBuffer.toLowerCase();
        const normalizedTranscript = transcript.toLowerCase();
        const alreadyCaptured =
          normalizedBuffer && normalizedTranscript.startsWith(normalizedBuffer);
        const addition = alreadyCaptured
          ? transcript.slice(speechBuffer.length).trim()
          : transcript;

        if (addition) {
          speechBuffer = speechBuffer ? `${speechBuffer} ${addition}`.trim() : addition;
          added = true;
        } else if (!alreadyCaptured) {
          speechBuffer = transcript;
          added = true;
        }

        lastFinalTranscript = transcript;
      }

      if (added) {
        startSilenceTimer();
      }
    }

    function handleSpeechError(event) {
      const friendlyMessage =
        event.error === "not-allowed" || event.error === "service-not-allowed"
          ? "Microphone permission was blocked."
          : `Speech recognition error: ${event.error}`;
      errorSpan.textContent = friendlyMessage;
      speechMode = SpeechMode.OFF;
      stopListening();
      updateMicButtonUI();
    }

    function handleRecognitionEnd() {
      isListening = false;
      updateMicButtonUI();
      // Continuous mode will be resumed explicitly after the model response.
    }

    function initSpeechRecognition() {
      if (!recognitionSupported) {
        micBtn.disabled = true;
        micBtn.classList.add("opacity-50", "cursor-not-allowed");
        micModeLabel.textContent = "Speech not supported";
        return;
      }
      recognition = new RecognitionClass();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = "en-US";
      recognition.onresult = handleSpeechResult;
      recognition.onerror = handleSpeechError;
      recognition.onend = handleRecognitionEnd;
      recognition.onstart = () => {
        isListening = true;
        updateMicButtonUI();
      };
    }

    function startListening() {
      if (!recognitionSupported || !recognition || isListening || pausedForResponse || pausedForTts) return;
      speechBuffer = "";
      lastFinalTranscript = "";
      try {
        recognition.start();
        isListening = true;
      } catch (err) {
        console.error(err);
      }
      updateMicButtonUI();
    }

    function stopListening() {
      clearTimeout(silenceTimer);
      silenceTimer = null;
      speechBuffer = "";
      lastFinalTranscript = "";
      if (recognitionSupported && recognition && isListening) {
        try {
          recognition.stop();
        } catch (err) {
          console.error(err);
        }
      }
      isListening = false;
      updateMicButtonUI();
    }

    function pauseRecognitionForResponse() {
      if (!recognitionSupported) return;
      pausedForResponse = true;
      stopListening();
    }

    function resumeRecognitionAfterResponse() {
      if (!recognitionSupported) return;
      pausedForResponse = false;
      if (pausedForTts) return;
      if (speechMode === SpeechMode.CONTINUOUS) {
        startListening();
      }
    }

    function pauseRecognitionForTts() {
      if (!recognitionSupported) return;
      if (speechMode !== SpeechMode.CONTINUOUS) return;
      pausedForTts = true;
      stopListening();
    }

    function resumeRecognitionAfterTts() {
      if (!recognitionSupported) return;
      if (!pausedForTts) return;
      pausedForTts = false;
      if (speechMode === SpeechMode.CONTINUOUS && !pausedForResponse && !awaitingResponse) {
        startListening();
      }
    }

    function updateMicButtonUI() {
      const isPaused = pausedForResponse || pausedForTts;
      const icon = speechMode === SpeechMode.OFF ? "mic-off" : isPaused ? "pause-circle" : "mic";
      micBtn.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i>`;
      lucide.createIcons();
      micModeLabel.textContent = speechModeLabels[speechMode] || "Speech off";
      micBtn.classList.toggle("bg-[#0052C4]", speechMode !== SpeechMode.OFF && isListening);
      micBtn.classList.toggle("text-white", speechMode !== SpeechMode.OFF && isListening);
      micBtn.classList.toggle("border-[#0052C4]", speechMode !== SpeechMode.OFF && isListening);
    }

    function setSpeechMode(mode) {
      if (!recognitionSupported && mode !== SpeechMode.OFF) {
        errorSpan.textContent = "Speech recognition is not available in this browser.";
        speechMode = SpeechMode.OFF;
        stopListening();
        updateMicButtonUI();
        return;
      }
      speechMode = mode;
      speechBuffer = "";
      pausedForResponse = false;
      pausedForTts = false;
      clearTimeout(silenceTimer);
      if (speechMode === SpeechMode.OFF) {
        stopListening();
      } else {
        startListening();
      }
      updateMicButtonUI();
    }

    function cycleSpeechMode() {
      const nextMode = (speechMode + 1) % 3;
      setSpeechMode(nextMode);
    }

    // Unified user message handler (text or speech)
    async function handleUserMessage(userText, { triggeredBySpeech = false } = {}) {
      errorSpan.textContent = "";
      clearFollowupSuggestions();
      const cleanedText = userText.trim();
      const hasPdf = Boolean(pdfAttachment);
      if (!cleanedText && !hasPdf) return;
      const fallbackPrompt = cleanedText || "Please review the attached PDF.";
      lastUserPrompt = fallbackPrompt;
      const narrativeUserInstruction =
        "You must respond in narrative format with no tables or bullet points.";
      const followupInstruction =
        "Append at least one follow-up prompt after your answer exactly as specified in the system instructions.";

      const focusPrefix = pendingFocusInstruction ? `${pendingFocusInstruction}. ` : "";
      const narrativePrefix = narrativeModeEnabled ? `${narrativeUserInstruction} ` : "";
      const messageToSend = `${focusPrefix}${narrativePrefix}${fallbackPrompt}\n\n${followupInstruction}`.trim();
      pendingFocusInstruction = "";

      const userLogText = cleanedText || "PDF attached.";
      addUserMessage(userLogText, pdfAttachment?.name);
      logToFirebase("user", userLogText);
      const contentPayload = hasPdf
        ? [
            { type: "text", text: messageToSend },
            {
              type: "file",
              file: {
                filename: pdfAttachment.name,
                file_data: pdfAttachment.dataUrl,
              },
            },
          ]
        : messageToSend;
      messages.push({ role: "user", content: contentPayload }); // Update history
      if (hasPdf) {
        resetPdfAttachment();
      }

      if (!triggeredBySpeech) {
        textarea.value = "";
        textarea.style.height = 'auto'; // Reset height
      }
      
      setTyping(true);
      awaitingResponse = true;

      if (speechMode === SpeechMode.CONTINUOUS) {
        pauseRecognitionForResponse();
      }

      // Local Crisis Check
      if (looksLikeCrisis(cleanedText)) {
        setTimeout(() => {
            const supportText = crisisResponse();
            const { contentEl, ttsButton } = addBotMessage(supportText);
            setTtsButtonText(ttsButton, supportText);
            ttsButton.dataset.userPrompt = cleanedText;
            messages.push({ role: "assistant", content: supportText });
            logToFirebase("assistant", supportText);
            if (autoTtsEnabled) {
              playTtsForText(supportText, ttsButton, contentEl);
            }
            awaitingResponse = false;
            setTyping(false);
            resumeRecognitionAfterResponse();
        }, 1000); 
        return;
      }

      // Backend Call with streaming
      try {
        const { assistantReply, followups, followupContainer } = await streamAssistantResponse();
        if (assistantReply) {
          messages.push({ role: "assistant", content: assistantReply });
          logToFirebase("assistant", assistantReply);
          renderFollowupSuggestions(followupContainer, followups);
        }
      } catch (err) {
        console.error(err);
        errorSpan.textContent = "Network error connecting to backend.";
      } finally {
        awaitingResponse = false;
        setTyping(false);
        if (speechMode === SpeechMode.PUSH_TO_TALK) {
          stopListening();
        } else if (speechMode === SpeechMode.CONTINUOUS) {
          resumeRecognitionAfterResponse();
        }
      }
    }

    // Form Submission
    form.addEventListener("submit", (event) => {
      event.preventDefault();
      handleUserMessage(textarea.value);
    });

    // Handle Enter key
    textarea.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            form.dispatchEvent(new Event("submit"));
        }
    });

    pdfBtn?.addEventListener("click", () => {
      pdfInput?.click();
    });

    pdfInput?.addEventListener("change", () => {
      errorSpan.textContent = "";
      const file = pdfInput.files?.[0];
      if (!file) {
        resetPdfAttachment();
        return;
      }
      const isPdf =
        file.type === "application/pdf" || file.name.toLowerCase().endsWith(".pdf");
      if (!isPdf) {
        errorSpan.textContent = "Please choose a PDF file.";
        resetPdfAttachment();
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        const result = reader.result;
        if (typeof result === "string") {
          setPdfAttachment(file, result);
        } else {
          errorSpan.textContent = "Unable to read the PDF file.";
          resetPdfAttachment();
        }
      };
      reader.onerror = () => {
        errorSpan.textContent = "Unable to read the PDF file.";
        resetPdfAttachment();
      };
      reader.readAsDataURL(file);
    });

    pdfClearBtn?.addEventListener("click", () => {
      resetPdfAttachment();
    });

    initSpeechRecognition();
    updateMicButtonUI();
    refreshVoices();
    updateSpeechOptionsUI();
    if ("speechSynthesis" in window) {
      window.speechSynthesis.onvoiceschanged = refreshVoices;
    }

    micBtn.addEventListener("click", () => {
      if (speechMode === SpeechMode.PUSH_TO_TALK && !isListening && !awaitingResponse && recognitionSupported) {
        startListening();
        return;
      }
      if (speechMode === SpeechMode.CONTINUOUS && !isListening && !awaitingResponse && recognitionSupported) {
        startListening();
        return;
      }
      cycleSpeechMode();
    });

    speechOptionsToggle?.addEventListener("click", () => {
      speechOptionsPanel?.classList.toggle("hidden");
    });

    document.addEventListener("click", (event) => {
      if (!speechOptionsPanel || !speechOptionsToggle) return;
      const target = event.target;
      if (!(target instanceof Node)) return;
      if (
        speechOptionsPanel.classList.contains("hidden") ||
        speechOptionsPanel.contains(target) ||
        speechOptionsToggle.contains(target)
      ) {
        return;
      }
      speechOptionsPanel.classList.add("hidden");
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        speechOptionsPanel?.classList.add("hidden");
      }
    });

    speechEngineSelect?.addEventListener("change", (event) => {
      const value = event.target.value;
      if (value === "huggingface" || value === "browser") {
        ttsEngine = value;
      }
      stopActiveAudio();
      updateSpeechOptionsUI();
    });

    speechSpeedSelect?.addEventListener("change", (event) => {
      const value = Number(event.target.value);
      if (ttsSpeedOptions.includes(value)) {
        ttsSpeed = value;
        if (activeUtterance) {
          activeUtterance.rate = ttsSpeed;
        }
      }
      updateSpeechOptionsUI();
    });

    speechVoiceInputs.forEach((input) => {
      input.addEventListener("change", () => {
        if (input.checked) {
          ttsVoice = input.value === "male" ? "male" : "female";
        }
        updateSpeechOptionsUI();
      });
    });

    downloadBtn?.addEventListener("click", downloadChat);

  </script>
</body>
</html>
