<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Course Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      color-scheme: light dark;
    }

    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: stretch;
      height: 100vh;
      background: #0f172a;
      color: #e5e7eb;
    }

    .chat-shell {
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top, #1f2937, #020617);
      overflow: hidden;
    }

    header {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #1f2937;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(8px);
    }

    header h1 {
      font-size: 1rem;
      margin: 0;
    }

    header span {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 6px #22c55e;
    }

    #chat-log {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      scroll-behavior: smooth;
    }

    .msg {
      max-width: 90%;
      padding: 0.5rem 0.75rem;
      border-radius: 0.75rem;
      font-size: 0.9rem;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .msg.user {
      margin-left: auto;
      background: #4f46e5;
      color: white;
      border-bottom-right-radius: 0.15rem;
    }

    .msg.assistant {
      margin-right: auto;
      background: #111827;
      border: 1px solid #1f2937;
      border-bottom-left-radius: 0.15rem;
    }

    .msg.system {
      margin: 0 auto;
      background: #0b1120;
      border-radius: 999px;
      padding-inline: 1rem;
      font-size: 0.75rem;
      color: #9ca3af;
    }

    form {
      border-top: 1px solid #1f2937;
      padding: 0.75rem;
      background: rgba(15, 23, 42, 0.98);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    textarea {
      resize: none;
      min-height: 60px;
      max-height: 160px;
      padding: 0.5rem 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
    }

    textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px #4f46e566;
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 0.4rem 1.2rem;
      font-size: 0.85rem;
      cursor: pointer;
      background: #4f46e5;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .hint {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .error {
      font-size: 0.8rem;
      color: #f97373;
      max-width: 260px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="chat-shell">
    <header>
      <div class="status-dot"></div>
      <div>
        <h1>AI Tools for Teaching Assistant</h1>
        <span>Answers based only on the provided AI tools resource</span>
      </div>
    </header>

    <div id="chat-log">
      <div class="msg system">
        Welcome! I’m your assistant for exploring AI tools for teaching. Ask me
        about the workflows or tools in this resource.
      </div>
    </div>

    <form id="chat-form">
      <textarea
        id="user-input"
        placeholder="Ask about AI tools for teaching, workflows, or how to use specific tools..."
      ></textarea>
      <div class="form-row">
        <div class="hint">
          I can only answer questions based on the AI tools for teaching resource I was given.
        </div>
        <div>
          <span id="error" class="error"></span>
          <button type="submit" id="send-btn">
            Send
            <span id="sending-spinner" style="display: none">…</span>
          </button>
        </div>
      </div>
    </form>
  </div>

  <script>
    const API_URL = "/.netlify/functions/openrouter-chat";
    const chatLog = document.getElementById("chat-log");
    const form = document.getElementById("chat-form");
    const textarea = document.getElementById("user-input");
    const errorSpan = document.getElementById("error");
    const sendBtn = document.getElementById("send-btn");
    const spinner = document.getElementById("sending-spinner");

    // Full message history (including system prompt)
    let messages = [];

    const knowledgeBase = `
## Resource meta
- **Title:** AI tools for teaching: Which ones are helpful and how should I use them?
- **Overview:** How different AI tools can support university teaching, with workflows for quick refreshes, interactivity, and full redevelopment. Includes an AI Tools Impact Matrix scoring teacher helpfulness (0–100), student helpfulness (0–100), and learning curve (1–10; green = easy, red = hard).

## Workflows
### Rapid course refresh (minimal time)
1) Gather relevant content (transcripts, policies, outlines). Improve weak transcripts with **Turboscribe**; work one week at a time.
2) Upload to a **mainstream LLM** (Gemini or ChatGPT) in deep-reasoning mode to review and update. Expect ~10+ minutes for a thorough report.
3) Ask the LLM for a slide transcript for an XX-minute PowerPoint (≤10 slides per recording on free tiers) to use as a teleprompter.
4) Upload transcript/content to **Gamma** to generate slides; tweak settings/images and export to PowerPoint for final edits.
5) Record the presentation with your preferred screen recorder (e.g., Loom) using the slides and transcript.
6) Upload the video and teleprompter text to your LMS (e.g., Canvas).
- **Notes:** Check accuracy at every stage. You can use **Openrouter** for model consensus but keep a human-in-the-loop.

### Make the course interactive
- Use the **AI Tools Impact Matrix (butterfly chart)**: teacher helpfulness on the left, student helpfulness on the right; bar color shows learning curve (green easy, red steep).
- **Recommendation:** Start with tools that have high student helpfulness and manageable learning curves; integrate them into activities, interactive content, and feedback.

### Full course redevelopment
1) Use **Openrouter** or a powerful LLM to build a detailed course plan.
2) Generate core materials with your expertise plus a **mainstream LLM** (Gemini, ChatGPT, Claude).
3) Provide materials to **NotebookLM** to create transcripts, slides, quizzes, podcasts, mind maps, and other resources.
4) Share the NotebookLM notebook with students (paid plan) for curated access.
5) Build student-facing chatbots with **ElevenLabs** (high-quality voice) or **Cogniti** (Canvas/institution integration).
6) For interactive activities (simulations, games, practice assessments), use coding-capable **mainstream LLMs** or specialised tools like **Codex**.
- **Notes:** Assumes major redesign. High-impact elements: strong NotebookLM notebook, custom chatbots, bespoke interactives.

## Tool highlights (sample)
- **Gamma** — AI-generated slides/websites/social media; teacher helpfulness 90, student 50, learning curve 1.
- **Openrouter** — Model hub for consensus across multiple LLMs in workflows.
- **Turboscribe** — Speech-to-text transcription; teacher 80, student 80, learning curve 1; great for converting lectures.
- **NotebookLM** — Curated content notebooks for generating transcripts, quizzes, and shared student access.
- **ElevenLabs** — Realistic voice models and voice chatbots (student helpfulness 100, learning curve 3).
- **Cogniti** — Canvas/institution-friendly chatbot tooling.
- **Gradescope** — AI-assisted marking platform; teacher helpfulness 100, student 50, learning curve 5.
- **Figma AI** — Design/prototyping with AI; learning design interfaces and diagrams.
- **Atlas** — Student study assistant with RAG; limited teacher control over content.
- **Scite.ai** — Citation analysis (supporting/contradicting/mentioning) for evidence-based teaching.
- **Opal** — No-code AI app builder for workflows; overlaps with Gemini/Claude.
- **Flow (Veo 3.1)** — Video creation with persistent characters/backgrounds for branching narratives.
- **MedGemma-27B** — Medically trained model (API, coding skills required).
- **Marble** — 3D world creation (early-stage, high effort vs payoff).
- **Lyria RealTime** — Real-time music generation via Gemini API.
    `.trim();

    function buildSystemPrompt() {
      return `
Your role:
- You are a general-purpose assistant.

You MUST follow these rules exactly:

1. PRIORITISE SAFETY OF THE USER
   - If the user appears to be in immediate danger, at risk of harming themselves, or describes serious harm from others:
     - Do NOT provide clinical advice.
     - Encourage them to seek urgent help.
     - Provide specific contacts such as:
       - Emergency services (e.g., call 000 in Australia).
       - National mental health helplines (e.g., Lifeline 13 11 14 in Australia).
       - Campus security and student support services (the teaching team will configure these for you).
   - Be warm, supportive, and non-judgemental.

2. ABSOLUTE SAFETY RESTRICTIONS
   - You must NEVER:
     - Provide instructions, methods, or encouragement for self-harm or suicide.
     - Provide guidance on illegal drugs, their manufacture, or their unsafe use.
     - Provide instructions for violence, weapons, or harming others.
   - If asked, clearly refuse and, where appropriate, gently steer the conversation to safety and wellbeing or back to course-related content.

3. STYLE
   - Use clear, concise explanations.
   - When explaining difficult concepts, use simple examples aimed at university educators.
   - When describing workflows, display the steps as a vertical list with emoji bullet points. Use bold headers for the action on each bullet, followed by details. Put "Tools" and "Why" on separate lines under the header.

KNOWLEDGE BASE (sole source of truth):
${knowledgeBase}
      `.trim();
    }

    function initMessages() {
      messages = [
        {
          role: "system",
          content: buildSystemPrompt(),
        },
      ];
    }

    // Initialise messages on load
    initMessages();

    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function formatMessage(content) {
      const escaped = escapeHtml(content);
      const withBold = escaped.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
      return withBold.replace(/\n/g, "<br>");
    }

    function addMessage(role, content) {
      const div = document.createElement("div");
      div.className = `msg ${role}`;
      div.innerHTML = formatMessage(content);
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function setLoading(isLoading) {
      sendBtn.disabled = isLoading;
      spinner.style.display = isLoading ? "inline" : "none";
    }

    // Simple local crisis detection to short-circuit and show support info
    function looksLikeCrisis(text) {
      const lowered = text.toLowerCase();
      const keywords = [
        "kill myself",
        "suicide",
        "want to die",
        "end my life",
        "self harm",
        "self-harm",
        "hurt myself",
      ];
      return keywords.some((k) => lowered.includes(k));
    }

    function crisisResponse() {
      // You can edit this text to match your campus.
      return `
I'm really glad you reached out — your safety and wellbeing are far more important than this course.

I can't provide crisis counselling, but please consider these options right now:

• If you are in immediate danger or feel unsafe: call Emergency Services on 000 (in Australia).
• You can contact Lifeline on 13 11 14 or via online chat at https://www.lifeline.org.au/.
• If you are a student, please contact your university's student wellbeing/services team or campus security as soon as possible (check your student portal for the right number).

You do not have to go through this alone — please reach out to someone you trust or one of the services above as soon as you can.
      `.trim();
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      errorSpan.textContent = "";

      const userText = textarea.value.trim();
      if (!userText) return;

      // Add user message to UI and history
      addMessage("user", userText);
      messages.push({ role: "user", content: userText });
      textarea.value = "";
      setLoading(true);

      // Local crisis handling (extra safety layer)
      if (looksLikeCrisis(userText)) {
        const supportText = crisisResponse();
        addMessage("assistant", supportText);
        messages.push({ role: "assistant", content: supportText });
        setLoading(false);
        return;
      }

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages }),
        });

        const rawText = await response.text();
        let data = null;
        try {
          data = JSON.parse(rawText);
        } catch (e) {
          console.error("Non-JSON response from backend:", rawText);
        }

        if (!response.ok) {
          console.error("Backend error:", data || rawText);
          let backendMsg = "The server returned an error. Check function logs.";
          if (data) {
            if (typeof data.error === "string") {
              backendMsg = data.error;
            } else if (
              data.error &&
              typeof data.error.message === "string"
            ) {
              backendMsg = data.error.message;
            } else {
              backendMsg = JSON.stringify(data);
            }
          } else if (rawText) {
            backendMsg = rawText;
          }
          errorSpan.textContent =
            "Error contacting the chatbot: " + backendMsg;
          setLoading(false);
          return;
        }

        const reply =
          data?.choices?.[0]?.message?.content ||
          "Sorry, I couldn't generate a response just now.";

        addMessage("assistant", reply);
        messages.push({ role: "assistant", content: reply });
      } catch (err) {
        console.error(err);
        errorSpan.textContent =
          "Network error contacting the chatbot. Please try again.";
      } finally {
        setLoading(false);
        textarea.focus();
      }
    });

    // Allow Ctrl+Enter / Cmd+Enter to send
    textarea.addEventListener("keydown", (event) => {
      if (
        (event.ctrlKey || event.metaKey) &&
        event.key === "Enter" &&
        !sendBtn.disabled
      ) {
        form.dispatchEvent(new Event("submit"));
      }
    });
  </script>

  
</body>
</html>
